<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="æŠ•è³‡åˆ†æå·¥å…·">
    <title>å€‹äººæŠ•è³‡åˆ†æå·¥å…· v2.0</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>ğŸ“Š</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 2.2em;
            font-weight: 300;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .section {
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .section h2 {
            color: #4a5568;
            margin-bottom: 15px;
            border-bottom: 3px solid #e2e8f0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        input, select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .industry-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .industry-card {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        }
        
        .industry-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        .industry-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .industry-card h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .industry-card p {
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .module {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            background: linear-gradient(135deg, #fff, #f8fafc);
            position: relative;
            overflow: hidden;
        }
        
        .module::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .module h3 {
            color: #4a5568;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }
        
        .weight-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .score-display {
            text-align: center;
            margin: 10px 0;
        }
        
        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin: 8px;
        }
        
        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #17a2b8, #6f42c1); }
        .score-average { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e83e8c); }
        
        .indicator-list h4 {
            font-size: 14px;
            color: #4a5568;
            margin: 10px 0 5px 0;
        }
        
        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .indicator-item span {
            flex: 1;
            margin-right: 8px;
        }
        
        .indicator-item input {
            width: 70px;
            padding: 4px;
            font-size: 12px;
        }
        
        .total-score {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .total-score h2 {
            font-size: 3em;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        
        .recommendation {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .rec-buy { background: linear-gradient(135deg, #d4edda, #c3e6cb); color: #155724; }
        .rec-hold { background: linear-gradient(135deg, #fff3cd, #ffeaa7); color: #856404; }
        .rec-sell { background: linear-gradient(135deg, #f8d7da, #f5c6cb); color: #721c24; }
        
        .valuation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .valuation-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .pessimistic { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .neutral { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .optimistic { background: linear-gradient(135deg, #10b981, #059669); }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #6b7280, #4b5563); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .alert-success { background: linear-gradient(135deg, #d4edda, #c3e6cb); color: #155724; border: 1px solid #c3e6cb; }
        .alert-warning { background: linear-gradient(135deg, #fff3cd, #ffeaa7); color: #856404; border: 1px solid #ffeaa7; }
        .alert-danger { background: linear-gradient(135deg, #f8d7da, #f5c6cb); color: #721c24; border: 1px solid #f5c6cb; }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            h1 { font-size: 1.8em; }
            .input-group { grid-template-columns: 1fr; gap: 8px; }
            .industry-selector { grid-template-columns: 1fr; }
            .module-grid { grid-template-columns: 1fr; }
            .valuation-grid { grid-template-columns: 1fr; }
            .action-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š å€‹äººæŠ•è³‡åˆ†æå·¥å…· <span class="version-badge">v2.0</span></h1>
        
        <div class="section">
            <h2>ğŸ¢ åŸºæœ¬è³‡è¨Š</h2>
            <div class="input-group">
                <label>äº¤æ˜“æ‰€:</label>
                <select id="exchange">
                    <option value="us">ç¾è‚¡ (US)</option>
                    <option value="tw">å°è‚¡ (TW)</option>
                    <option value="hk">æ¸¯è‚¡ (HK)</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <span></span>
            </div>
            <div class="input-group">
                <label>è‚¡ç¥¨ä»£ç¢¼:</label>
                <input type="text" id="stockCode" placeholder="å¦‚: AAPL, 2330, 00878">
                <span></span>
            </div>
            <div class="input-group">
                <label>ç•¶å‰è‚¡åƒ¹:</label>
                <input type="number" id="currentPrice" placeholder="è¼¸å…¥ç•¶å‰è‚¡åƒ¹" step="0.01">
                <span id="currencyDisplay">USD</span>
            </div>
            <div class="input-group">
                <label>å¸‚å€¼:</label>
                <input type="number" id="marketCap" placeholder="è¼¸å…¥å¸‚å€¼" step="0.1">
                <span id="marketCapDisplay">å„„USD</span>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ­ ç”¢æ¥­é¡åˆ¥é¸æ“‡</h2>
            <div class="industry-selector">
                <div class="industry-card" data-industry="tech">
                    <h3>ğŸ’» ç§‘æŠ€æˆé•·å‹</h3>
                    <p>è»Ÿé«”ã€åŠå°é«”ã€é›»å•†</p>
                </div>
                <div class="industry-card" data-industry="cyclical">
                    <h3>ğŸ”„ é€±æœŸå‹</h3>
                    <p>é‹¼éµã€åŒ–å·¥ã€èˆªé‹</p>
                </div>
                <div class="industry-card" data-industry="defensive">
                    <h3>ğŸ›¡ï¸ é˜²ç¦¦å‹</h3>
                    <p>å…¬ç”¨äº‹æ¥­ã€é£Ÿå“ã€é›»ä¿¡</p>
                </div>
                <div class="industry-card" data-industry="financial">
                    <h3>ğŸ¦ é‡‘èå‹</h3>
                    <p>éŠ€è¡Œã€ä¿éšªã€è­‰åˆ¸</p>
                </div>
                <div class="industry-card" data-industry="capital">
                    <h3>ğŸ—ï¸ è³‡æœ¬å¯†é›†å‹</h3>
                    <p>æˆ¿åœ°ç”¢ã€åŸºå»ºã€èƒ½æº</p>
                </div>
                <div class="industry-card" data-industry="consumer">
                    <h3>ğŸ›ï¸ æ¶ˆè²»å‹</h3>
                    <p>é›¶å”®ã€é¤é£²ã€å¥¢ä¾ˆå“</p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“ˆ è©•åˆ†æ¨¡çµ„</h2>
            <div class="module-grid" id="moduleGrid">
                <p style="text-align: center; color: #6b7280; padding: 40px;">è«‹å…ˆé¸æ“‡ç”¢æ¥­é¡åˆ¥ä»¥é¡¯ç¤ºè©•åˆ†æ¨¡çµ„</p>
            </div>
        </div>
        
        <div class="total-score">
            <h2 id="totalScore">--</h2>
            <p>ç¸½è©•åˆ†</p>
            <div class="recommendation" id="recommendation">è«‹å…ˆå®Œæˆæ‰€æœ‰è©•ä¼°</div>
        </div>
        
        <div class="section">
            <h2>ğŸ’° ä¸‰æƒ…å¢ƒä¼°å€¼æ¨¡å‹</h2>
            <div class="valuation-grid">
                <div class="valuation-card pessimistic">
                    <h3>æ‚²è§€æƒ…å¢ƒ</h3>
                    <p id="pessimisticPrice">--</p>
                    <small id="pessimisticAssumption">--</small>
                </div>
                <div class="valuation-card neutral">
                    <h3>ä¸­ç«‹æƒ…å¢ƒ</h3>
                    <p id="neutralPrice">--</p>
                    <small id="neutralAssumption">--</small>
                </div>
                <div class="valuation-card optimistic">
                    <h3>æ¨‚è§€æƒ…å¢ƒ</h3>
                    <p id="optimisticPrice">--</p>
                    <small id="optimisticAssumption">--</small>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ¯ æ“ä½œå»ºè­°</h2>
            <div id="actionSuggestions">
                <p>è«‹å®Œæˆè©•åˆ†å¾ŒæŸ¥çœ‹æ“ä½œå»ºè­°</p>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn-primary" onclick="calculateAnalysis()">ğŸš€ é–‹å§‹åˆ†æ</button>
            <button class="btn-secondary" onclick="exportReport()">ğŸ“Š å°å‡ºå ±å‘Š</button>
            <button class="btn-success" onclick="saveData()">ğŸ’¾ ä¿å­˜æ•¸æ“š</button>
            <button class="btn-warning" onclick="resetAll()">ğŸ”„ é‡è¨­æ‰€æœ‰</button>
        </div>
        
        <div class="section">
            <h2>ğŸ“± æ‰‹æ©Ÿä½¿ç”¨æŒ‡å—</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: linear-gradient(135deg, #ecfdf5, #d1fae5); border-radius: 10px;">
                    <h4>ğŸ iPhone ç”¨æˆ¶</h4>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>ç”¨ Safari é–‹å•Ÿæ­¤é é¢</li>
                        <li>é»æ“Šåº•éƒ¨ã€Œåˆ†äº«ã€æŒ‰éˆ•</li>
                        <li>é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</li>
                        <li>è¨­å®šåç¨±å¾Œç¢ºèª</li>
                    </ol>
                </div>
                <div style="padding: 15px; background: linear-gradient(135deg, #fef3c7, #fcd34d); border-radius: 10px;">
                    <h4>ğŸ¤– Android ç”¨æˆ¶</h4>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>ç”¨ Chrome é–‹å•Ÿæ­¤é é¢</li>
                        <li>é»æ“Šå³ä¸Šè§’ã€Œâ‹®ã€é¸å–®</li>
                        <li>é¸æ“‡ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€</li>
                        <li>ç¢ºèªæ·»åŠ </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const industryConfigs = {
            tech: {
                name: 'ç§‘æŠ€æˆé•·å‹',
                modules: {
                    growth: { weight: 40, name: 'æˆé•·æ€§', indicators: ['ç‡Ÿæ”¶æˆé•·ç‡', 'ç ”ç™¼è²»ç”¨æ¯”', 'æ–°ç”¢å“ç‡Ÿæ”¶å æ¯”', 'ç”¨æˆ¶å¢é•·ç‡'] },
                    profitability: { weight: 30, name: 'ç›ˆåˆ©èƒ½åŠ›', indicators: ['æ¯›åˆ©ç‡', 'ROE', 'ROA', 'æ·¨åˆ©ç‡'] },
                    valuation: { weight: 20, name: 'ä¼°å€¼', indicators: ['PEG', 'P/S', 'EV/Revenue'] },
                    health: { weight: 10, name: 'è²¡å‹™å¥åº·', indicators: ['ç¾é‡‘æ¯”', 'è² å‚µç‡', 'æµå‹•æ¯”ç‡'] }
                },
                valuation: {
                    pessimistic: { desc: 'P/E=15x, åˆ©ç‡ä¸Šå‡+ç«¶çˆ­åŠ åŠ‡' },
                    neutral: { desc: 'P/E=25x, ç©©å®šæˆé•·è»Œé“' },
                    optimistic: { desc: 'P/E=40x, AIé©å‘½æ€§çªç ´' }
                }
            },
            cyclical: {
                name: 'é€±æœŸå‹',
                modules: {
                    health: { weight: 40, name: 'è²¡å‹™å¥åº·', indicators: ['è² å‚µç‡', 'ç¾é‡‘æ¯”', 'ç‡Ÿé‹ç¾é‡‘æµ', 'æ·¨ç¾é‡‘æ¯”ç‡'] },
                    valuation: { weight: 30, name: 'ä¼°å€¼', indicators: ['P/B', 'EV/EBITDA', 'é€±æœŸèª¿æ•´P/E'] },
                    profitability: { weight: 20, name: 'ç›ˆåˆ©èƒ½åŠ›', indicators: ['ROEé€±æœŸæ€§', 'æ¯›åˆ©ç‡ç©©å®šæ€§'] },
                    growth: { weight: 10, name: 'æˆé•·æ€§', indicators: ['ç”¢èƒ½æ“´å¼µ', 'å¸‚å ç‡è®ŠåŒ–'] }
                },
                valuation: {
                    pessimistic: { desc: 'P/B=0.8x, é€±æœŸåº•éƒ¨' },
                    neutral: { desc: 'P/B=1.2x, é€±æœŸä¸­æ®µ' },
                    optimistic: { desc: 'P/B=1.8x, é€±æœŸé«˜é»' }
                }
            },
            defensive: {
                name: 'é˜²ç¦¦å‹',
                modules: {
                    profitability: { weight: 35, name: 'ç›ˆåˆ©èƒ½åŠ›', indicators: ['ROEç©©å®šæ€§', 'è‚¡æ¯ç‡', 'æ·¨åˆ©ç‡'] },
                    health: { weight: 30, name: 'è²¡å‹™å¥åº·', indicators: ['è² å‚µç‡', 'åˆ©æ¯è¦†è“‹', 'æµå‹•æ¯”ç‡'] },
                    valuation: { weight: 25, name: 'ä¼°å€¼', indicators: ['è‚¡æ¯æ®–åˆ©ç‡', 'P/E', 'Betaä¿‚æ•¸'] },
                    growth: { weight: 10, name: 'æˆé•·æ€§', indicators: ['ç‡Ÿæ”¶ç©©å®šæ€§', 'å¸‚å ç‡'] }
                },
                valuation: {
                    pessimistic: { desc: 'è‚¡æ¯æ®–åˆ©ç‡=6%' },
                    neutral: { desc: 'è‚¡æ¯æ®–åˆ©ç‡=4.5%' },
                    optimistic: { desc: 'è‚¡æ¯æ®–åˆ©ç‡=3.5%' }
                }
            },
            financial: {
                name: 'é‡‘èå‹',
                modules: {
                    health: { weight: 35, name: 'è²¡å‹™å¥åº·', indicators: ['è³‡æœ¬é©è¶³ç‡', 'é€¾æ”¾æ¯”', 'å‚™æŠµè¦†è“‹ç‡'] },
                    profitability: { weight: 35, name: 'ç›ˆåˆ©èƒ½åŠ›', indicators: ['ROE', 'æ·¨åˆ©å·®', 'æˆæœ¬æ”¶å…¥æ¯”'] },
                    valuation: { weight: 20, name: 'ä¼°å€¼', indicators: ['P/B', 'æœ¬ç›Šæ¯”', 'è‚¡åƒ¹æ·¨å€¼æ¯”'] },
                    growth: { weight: 10, name: 'æˆé•·æ€§', indicators: ['æ”¾æ¬¾æˆé•·', 'å­˜æ¬¾æˆé•·'] }
                },
                valuation: {
                    pessimistic: { desc: 'P/B=0.7x, åˆ©å·®å£“ç¸®' },
                    neutral: { desc: 'P/B=1.0x, ç©©å®šç¶“ç‡Ÿ' },
                    optimistic: { desc: 'P/B=1.4x, åˆ©ç‡ä¸Šå‡å—ç›Š' }
                }
            },
            capital: {
                name: 'è³‡æœ¬å¯†é›†å‹',
                modules: {
                    health: { weight: 35, name: 'è²¡å‹™å¥åº·', indicators: ['è² å‚µç‡', 'åˆ©æ¯è¦†è“‹', 'ç‡Ÿé‹ç¾é‡‘æµ'] },
                    valuation: { weight: 30, name: 'ä¼°å€¼', indicators: ['P/B', 'EV/EBITDA', 'NAVæŠ˜åƒ¹'] },
                    profitability: { weight: 25, name: 'ç›ˆåˆ©èƒ½åŠ›', indicators: ['ROIC', 'è³‡ç”¢å‘¨è½‰ç‡'] },
                    growth: { weight: 10, name: 'æˆé•·æ€§', indicators: ['è³‡ç”¢æ“´å¼µ', 'ç§Ÿé‡‘æˆé•·'] }
                },
                valuation: {
                    pessimistic: { desc: 'P/B=0.8x, è³‡ç”¢æ¸›å€¼é¢¨éšª' },
                    neutral: { desc: 'P/B=1.2x, ç©©å®šç¶“ç‡Ÿ' },
                    optimistic: { desc: 'P/B=1.6x, è³‡ç”¢é‡ä¼°' }
                }
            },
            consumer: {
                name: 'æ¶ˆè²»å‹',
                modules: {
                    growth: { weight: 35, name: 'æˆé•·æ€§', indicators: ['åŒåº—æˆé•·ç‡', 'æ–°å“æˆåŠŸç‡', 'é€šè·¯æ“´å¼µ'] },
                    profitability: { weight: 30, name: 'ç›ˆåˆ©èƒ½åŠ›', indicators: ['æ¯›åˆ©ç‡', 'ROE', 'å“ç‰Œæº¢åƒ¹'] },
                    valuation: { weight: 25, name: 'ä¼°å€¼', indicators: ['P/E', 'EV/EBITDA'] },
                    health: { weight: 10, name: 'è²¡å‹™å¥åº·', indicators: ['ç¾é‡‘æµ', 'è² å‚µç‡'] }
                },
                valuation: {
                    pessimistic: { desc: 'P/E=15x, æ¶ˆè²»èç¸®' },
                    neutral: { desc: 'P/E=22x, ç©©å¥æˆé•·' },
                    optimistic: { desc: 'P/E=30x, æ¶ˆè²»å‡ç´š' }
                }
            }
        };
        
        let selectedIndustry = null, selectedExchange = 'us', moduleScores = {};
        
        document.addEventListener('DOMContentLoaded', () => updateCurrencyDisplay());
        document.getElementById('exchange').addEventListener('change', function() {
            selectedExchange = this.value;
            updateCurrencyDisplay();
        });
        
        function updateCurrencyDisplay() {
            const currencies = { us: 'USD', tw: 'TWD', hk: 'HKD', other: 'USD' };
            const currency = currencies[selectedExchange];
            document.getElementById('currencyDisplay').textContent = currency;
            document.getElementById('marketCapDisplay').textContent = `å„„${currency}`;
        }
        
        document.querySelectorAll('.industry-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.industry-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedIndustry = this.dataset.industry;
                generateModules();
            });
        });
        
        function generateModules() {
            if (!selectedIndustry) return;
            const config = industryConfigs[selectedIndustry];
            const moduleGrid = document.getElementById('moduleGrid');
            moduleGrid.innerHTML = '';
            moduleScores = {};
            
            Object.keys(config.modules).forEach(moduleId => {
                const module = config.modules[moduleId];
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module';
                moduleDiv.innerHTML = `
                    <h3>${module.name}<span class="weight-badge">${module.weight}%</span></h3>
                    <div class="score-display">
                        <div class="score-circle score-average" id="score-${moduleId}">--</div>
                    </div>
                    <div class="indicator-list">
                        <h4>é—œéµæŒ‡æ¨™:</h4>
                        ${module.indicators.map(indicator => `
                            <div class="indicator-item">
                                <span>${indicator}:</span>
                                <input type="number" placeholder="0-100" min="0" max="100" 
                                       onchange="updateModuleScore('${moduleId}')" data-indicator="${indicator}">
                            </div>
                        `).join('')}
                    </div>
                `;
                moduleGrid.appendChild(moduleDiv);
            });
        }
        
        function updateModuleScore(moduleId) {
            const moduleDiv = document.querySelector(`#score-${moduleId}`).closest('.module');
            const inputs = moduleDiv.querySelectorAll('input[type="number"]');
            let total = 0, count = 0;
            
            inputs.forEach(input => {
                if (input.value && input.value !== '') {
                    total += parseFloat(input.value);
                    count++;
                }
            });
            
            if (count > 0) {
                const average = total / count;
                moduleScores[moduleId] = average;
                const scoreCircle = document.getElementById(`score-${moduleId}`);
                scoreCircle.textContent = Math.round(average);
                scoreCircle.className = 'score-circle ' + getScoreClass(average);
            } else {
                delete moduleScores[moduleId];
                const scoreCircle = document.getElementById(`score-${moduleId}`);
                scoreCircle.textContent = '--';
                scoreCircle.className = 'score-circle score-average';
            }
            calculateTotalScore();
        }
        
        function getScoreClass(score) {
            if (score >= 80) return 'score-excellent';
            if (score >= 70) return 'score-good';
            if (score >= 50) return 'score-average';
            return 'score-poor';
        }
        
        function calculateTotalScore() {
            if (!selectedIndustry || Object.keys(moduleScores).length === 0) {
                document.getElementById('totalScore').textContent = '--';
                document.getElementById('recommendation').textContent = 'è«‹å…ˆå®Œæˆæ‰€æœ‰è©•ä¼°';
                document.getElementById('recommendation').className = 'recommendation';
                return;
            }
            
            const config = industryConfigs[selectedIndustry];
            let weightedSum = 0, totalWeight = 0;
            
            Object.keys(moduleScores).forEach(moduleId => {
                const weight = config.modules[moduleId].weight;
                weightedSum += moduleScores[moduleId] * weight;
                totalWeight += weight;
            });
            
            const totalScore = Math.round(weightedSum / totalWeight);
            document.getElementById('totalScore').textContent = totalScore;
            updateRecommendation(totalScore);
            updateValuation(totalScore);
        }
        
        function updateRecommendation(score) {
            const recElement = document.getElementById('recommendation');
            if (score >= 80) {
                recElement.textContent = 'ğŸš€ å¼·çƒˆè²·å…¥ - å„ªè³ªæ¨™çš„ï¼Œå»ºè­°ç©æ¥µé…ç½®';
                recElement.className = 'recommendation rec-buy';
            } else if (score >= 70) {
                recElement.textContent = 'ğŸ“ˆ è²·å…¥ - åŸºæœ¬é¢è‰¯å¥½ï¼Œå¯ä»¥è€ƒæ…®æŠ•è³‡';
                recElement.className = 'recommendation rec-buy';
            } else if (score >= 50) {
                recElement.textContent = 'ğŸ¤” æŒæœ‰ - ä¸­æ€§è©•åƒ¹ï¼Œå»ºè­°è§€æœ›';
                recElement.className = 'recommendation rec-hold';
            } else if (score >= 30) {
                recElement.textContent = 'âš ï¸ æ¸›æŒ - é¢¨éšªåé«˜ï¼Œå»ºè­°è¬¹æ…';
                recElement.className = 'recommendation rec-sell';
            } else {
                recElement.textContent = 'âŒ è³£å‡º - åŸºæœ¬é¢è¼ƒå·®ï¼Œå»ºè­°å›é¿';
                recElement.className = 'recommendation rec-sell';
            }
        }
        
        function updateValuation(score) {
            const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 0;
            if (!currentPrice || !selectedIndustry) return;
            
            const config = industryConfigs[selectedIndustry];
            const adjustment = (score - 50) / 100;
            const baseMultipliers = { pessimistic: 0.8, neutral: 1.0, optimistic: 1.3 };
            
            Object.keys(baseMultipliers).forEach(scenario => {
                const multiplier = baseMultipliers[scenario] * (1 + adjustment);
                const estimatedPrice = currentPrice * multiplier;
                document.getElementById(`${scenario}Price`).textContent = `${estimatedPrice.toFixed(2)}`;
                document.getElementById(`${scenario}Assumption`).textContent = config.valuation[scenario].desc;
            });
        }
        
        function calculateAnalysis() {
            if (!selectedIndustry) return showAlert('è«‹å…ˆé¸æ“‡ç”¢æ¥­é¡åˆ¥', 'warning');
            const stockCode = document.getElementById('stockCode').value;
            const currentPrice = document.getElementById('currentPrice').value;
            if (!stockCode || !currentPrice) return showAlert('è«‹å¡«å¯«è‚¡ç¥¨ä»£ç¢¼å’Œç•¶å‰è‚¡åƒ¹', 'warning');
            if (Object.keys(moduleScores).length === 0) return showAlert('è«‹å…ˆç‚ºå„é …æŒ‡æ¨™è©•åˆ†', 'warning');
            
            calculateTotalScore();
            generateActionSuggestions();
            showAlert('åˆ†æå®Œæˆï¼', 'success');
        }
        
        function generateActionSuggestions() {
            const totalScore = parseInt(document.getElementById('totalScore').textContent);
            const suggestionsDiv = document.getElementById('actionSuggestions');
            if (isNaN(totalScore)) return suggestionsDiv.innerHTML = '<p>è«‹å®Œæˆè©•åˆ†å¾ŒæŸ¥çœ‹æ“ä½œå»ºè­°</p>';
            
            let suggestions = '';
            if (totalScore >= 80) {
                suggestions = `<div class="alert alert-success"><h4>ğŸ’ å„ªè³ªæŠ•è³‡æ¨™çš„</h4><ul><li>å»ºè­°åˆ†æ‰¹å»ºå€‰ï¼Œç›®æ¨™é…ç½® 15-20%</li><li>å¯è€ƒæ…®é€¢ä½åŠ ç¢¼æ©Ÿæœƒ</li><li>è¨­å®šæ­¢ç›ˆé»ï¼šç•¶å‰åƒ¹æ ¼ +30%</li><li>è¨­å®šæ­¢æé»ï¼šç•¶å‰åƒ¹æ ¼ -15%</li></ul></div>`;
            } else if (totalScore >= 70) {
                suggestions = `<div class="alert alert-success"><h4>ğŸ“ˆ å€¼å¾—æŠ•è³‡æ¨™çš„</h4><ul><li>å»ºè­°é©åº¦é…ç½®ï¼Œç›®æ¨™é…ç½® 10-15%</li><li>å¯†åˆ‡é—œæ³¨åŸºæœ¬é¢è®ŠåŒ–</li><li>è¨­å®šæ­¢ç›ˆé»ï¼šç•¶å‰åƒ¹æ ¼ +25%</li><li>è¨­å®šæ­¢æé»ï¼šç•¶å‰åƒ¹æ ¼ -12%</li></ul></div>`;
            } else if (totalScore >= 50) {
                suggestions = `<div class="alert alert-warning"><h4>ğŸ¤” ä¸­æ€§è§€æœ›æ¨™çš„</h4><ul><li>å»ºè­°å°å€‰ä½è©¦æ¢ï¼Œé…ç½®ä¸è¶…é 5%</li><li>ç­‰å¾…æ›´å¥½çš„é€²å ´æ™‚æ©Ÿ</li><li>å¯†åˆ‡é—œæ³¨ç”¢æ¥­å‹•å‘</li><li>è¨­å®šè¼ƒç·Šçš„æ­¢æï¼šç•¶å‰åƒ¹æ ¼ -8%</li></ul></div>`;
            } else {
                suggestions = `<div class="alert alert-danger"><h4>âš ï¸ é«˜é¢¨éšªæ¨™çš„</h4><ul><li>å»ºè­°å›é¿æˆ–æ¸›æŒ</li><li>å¦‚å·²æŒæœ‰ï¼Œè€ƒæ…®åˆ†æ‰¹å‡ºå ´</li><li>ç­‰å¾…åŸºæœ¬é¢æ˜é¡¯æ”¹å–„</li><li>è¨­å®šåš´æ ¼æ­¢æï¼šç•¶å‰åƒ¹æ ¼ -5%</li></ul></div>`;
            }
            suggestionsDiv.innerHTML = suggestions;
        }
        
        function exportReport() {
            if (!selectedIndustry || Object.keys(moduleScores).length === 0) return showAlert('è«‹å…ˆå®Œæˆåˆ†æ', 'warning');
            
            const stockCode = document.getElementById('stockCode').value || 'æœªå¡«å¯«';
            const currentPrice = document.getElementById('currentPrice').value || 'æœªå¡«å¯«';
            const totalScore = document.getElementById('totalScore').textContent;
            const recommendation = document.getElementById('recommendation').textContent;
            
            const report = `æŠ•è³‡åˆ†æå ±å‘Š\n=================\nè‚¡ç¥¨ä»£ç¢¼: ${stockCode}\nç•¶å‰è‚¡åƒ¹: ${currentPrice}\nç”¢æ¥­é¡åˆ¥: ${industryConfigs[selectedIndustry].name}\nåˆ†ææ—¥æœŸ: ${new Date().toLocaleDateString('zh-TW')}\n\nè©•åˆ†çµæœ:\n${Object.keys(moduleScores).map(moduleId => {
                const moduleName = industryConfigs[selectedIndustry].modules[moduleId].name;
                const score = moduleScores[moduleId];
                return `${moduleName}: ${Math.round(score)}åˆ†`;
            }).join('\n')}\n\nç¸½è©•åˆ†: ${totalScore}åˆ†\næŠ•è³‡å»ºè­°: ${recommendation}\n\nä¼°å€¼å€é–“:\næ‚²è§€æƒ…å¢ƒ: ${document.getElementById('pessimisticPrice').textContent}\nä¸­ç«‹æƒ…å¢ƒ: ${document.getElementById('neutralPrice').textContent}\næ¨‚è§€æƒ…å¢ƒ: ${document.getElementById('optimisticPrice').textContent}\n\nå ±å‘Šç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}`;
            
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æŠ•è³‡åˆ†æå ±å‘Š_${stockCode}_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            showAlert('å ±å‘Šå·²å°å‡ºï¼', 'success');
        }
        
        function saveData() {
            const data = {
                exchange: selectedExchange,
                stockCode: document.getElementById('stockCode').value,
                currentPrice: document.getElementById('currentPrice').value,
                marketCap: document.getElementById('marketCap').value,
                selectedIndustry: selectedIndustry,
                moduleScores: moduleScores,
                savedAt: new Date().toISOString()
            };
            
            try {
                const dataStr = JSON.stringify(data);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æŠ•è³‡åˆ†ææ•¸æ“š_${data.stockCode || 'unknown'}_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showAlert('æ•¸æ“šå·²ä¿å­˜ï¼', 'success');
            } catch (error) {
                showAlert('ä¿å­˜å¤±æ•—ï¼š' + error.message, 'danger');
            }
        }
        
        function resetAll() {
            if (confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                document.getElementById('exchange').value = 'us';
                document.getElementById('stockCode').value = '';
                document.getElementById('currentPrice').value = '';
                document.getElementById('marketCap').value = '';
                document.querySelectorAll('.industry-card').forEach(c => c.classList.remove('selected'));
                selectedIndustry = null;
                moduleScores = {};
                document.getElementById('moduleGrid').innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">è«‹å…ˆé¸æ“‡ç”¢æ¥­é¡åˆ¥ä»¥é¡¯ç¤ºè©•åˆ†æ¨¡çµ„</p>';
                document.getElementById('totalScore').textContent = '--';
                document.getElementById('recommendation').textContent = 'è«‹å…ˆå®Œæˆæ‰€æœ‰è©•ä¼°';
                document.getElementById('recommendation').className = 'recommendation';
                ['pessimistic', 'neutral', 'optimistic'].forEach(scenario => {
                    document.getElementById(`${scenario}Price`).textContent = '--';
                    document.getElementById(`${scenario}Assumption`).textContent = '--';
                });
                document.getElementById('actionSuggestions').innerHTML = '<p>è«‹å®Œæˆè©•åˆ†å¾ŒæŸ¥çœ‹æ“ä½œå»ºè­°</p>';
                updateCurrencyDisplay();
                showAlert('å·²é‡è¨­æ‰€æœ‰æ•¸æ“š', 'success');
            }
        }
        
        function showAlert(message, type = 'success') {
            const existingAlert = document.querySelector('.temp-alert');
            if (existingAlert) existingAlert.remove();
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} temp-alert`;
            alert.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);';
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => { if (alert.parentNode) alert.remove(); }, 3000);
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's': e.preventDefault(); saveData(); break;
                    case 'r': if (e.shiftKey) { e.preventDefault(); resetAll(); } break;
                    case 'Enter': e.preventDefault(); calculateAnalysis(); break;
                }
            }
        });
        
        function validateInputs() {
            const stockCode = document.getElementById('stockCode').value;
            const currentPrice = document.getElementById('currentPrice').value;
            
            if (stockCode && !/^[A-Za-z0-9.]+$/.test(stockCode)) {
                showAlert('è‚¡ç¥¨ä»£ç¢¼æ ¼å¼ä¸æ­£ç¢º', 'warning');
                return false;
            }
            if (currentPrice && (isNaN(currentPrice) || parseFloat(currentPrice) <= 0)) {
                showAlert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è‚¡åƒ¹', 'warning');
                return false;
            }
            return true;
        }
        
        document.getElementById('stockCode').addEventListener('blur', validateInputs);
        document.getElementById('currentPrice').addEventListener('blur', validateInputs);
    </script>
</body>
</html>
