document.getElementById(id + 'Score');
            
            if (slider && display) {
                slider.addEventListener('input', function() {
                    display.textContent = this.value;
                    qualitativeScores[id] = parseInt(this.value);
                    updateConfidenceLevel();
                });
            }
        });
        
        // AIåˆ†æé–‹é—œ
        document.getElementById('aiAnalysis').addEventListener('change', function() {
            const insights = document.getElementById('aiInsights');
            insights.style.display = this.checked ? 'block' : 'none';
            if (this.checked) {
                runAIAnalysis();
            }
        });
        
        // å‹•æ…‹æ¬Šé‡èª¿æ•´
        function updateDynamicWeights() {
            if (!selectedIndustry || !selectedEnvironment) return;
            
            const config = enhancedIndustryConfigs[selectedIndustry];
            if (!config) return;
            
            const environmentAdjustments = getEnvironmentAdjustments();
            
            const weightDisplay = document.querySelector('.dynamic-weights');
            if (weightDisplay) {
                weightDisplay.innerHTML = `
                    âš¡ å‹•æ…‹æ¬Šé‡èª¿æ•´ï¼š
                    æˆé•·æ€§ ${config.baseWeights.growth + environmentAdjustments.growth}% |
                    ç›ˆåˆ©èƒ½åŠ› ${config.baseWeights.profitability + environmentAdjustments.profitability}% |
                    ä¼°å€¼ ${config.baseWeights.valuation + environmentAdjustments.valuation}% |
                    è²¡å‹™å¥åº· ${config.baseWeights.health + environmentAdjustments.health}%
                `;
            }
        }
        
        // ç’°å¢ƒèª¿æ•´ä¿‚æ•¸
        function getEnvironmentAdjustments() {
            const adjustments = { growth: 0, profitability: 0, valuation: 0, health: 0 };
            
            if (selectedEnvironment === 'bear') {
                adjustments.health += 10;
                adjustments.valuation += 5;
                adjustments.growth -= 10;
                adjustments.profitability -= 5;
            } else if (selectedEnvironment === 'bull') {
                adjustments.growth += 10;
                adjustments.valuation -= 5;
                adjustments.health -= 5;
            } else if (selectedEnvironment === 'volatile') {
                adjustments.health += 15;
                adjustments.growth -= 10;
                adjustments.valuation -= 5;
            }
            
            return adjustments;
        }
        
        // ç”Ÿæˆå¢å¼·æ¨¡çµ„
        function generateEnhancedModules() {
            if (!selectedIndustry) return;
            
            const config = enhancedIndustryConfigs[selectedIndustry];
            if (!config) return;
            
            const moduleGrid = document.getElementById('moduleGrid');
            moduleGrid.innerHTML = '';
            
            Object.keys(config.modules).forEach(moduleId => {
                const module = config.modules[moduleId];
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module';
                moduleDiv.innerHTML = `
                    <h3>
                        ${module.name}
                        <span class="weight-badge">${module.weight}%</span>
                    </h3>
                    <div class="score-display">
                        <div class="score-circle score-average" id="score-${moduleId}">--</div>
                    </div>
                    <div class="indicator-list">
                        <h4>é‡åŒ–æŒ‡æ¨™:</h4>
                        ${module.indicators.map(indicator => `
                            <div class="indicator-item">
                                <span>${indicator}:</span>
                                <input type="number" 
                                       placeholder="0-100" 
                                       min="0" max="100" 
                                       onchange="updateModuleScore('${moduleId}')"
                                       data-indicator="${indicator}">
                            </div>
                        `).join('')}
                        
                        <h4>è³ªåŒ–æŒ‡æ¨™:</h4>
                        ${module.qualitative.map(qual => `
                            <div class="indicator-item">
                                <span>${qual}:</span>
                                <input type="range" 
                                       min="0" max="100" value="50"
                                       class="confidence-slider"
                                       onchange="updateQualitativeScore('${moduleId}', '${qual}', this.value)">
                                <span class="qual-score">50</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                moduleGrid.appendChild(moduleDiv);
            });
        }
        
        // æ›´æ–°æ¨¡çµ„è©•åˆ†
        function updateModuleScore(moduleId) {
            const moduleDiv = document.querySelector(`#score-${moduleId}`).closest('.module');
            const inputs = moduleDiv.querySelectorAll('input[type="number"]');
            let total = 0;
            let count = 0;
            
            inputs.forEach(input => {
                if (input.value) {
                    total += parseFloat(input.value);
                    count++;
                }
            });
            
            // åŠ å…¥è³ªåŒ–è©•åˆ†
            if (qualitativeScores[moduleId]) {
                const qualScores = Object.values(qualitativeScores[moduleId]);
                if (qualScores.length > 0) {
                    const qualAvg = qualScores.reduce((a, b) => a + b, 0) / qualScores.length;
                    total += qualAvg;
                    count++;
                }
            }
            
            const score = count > 0 ? Math.round(total / count) : 0;
            moduleScores[moduleId] = score;
            
            const scoreCircle = document.getElementById(`score-${moduleId}`);
            scoreCircle.textContent = score;
            scoreCircle.className = 'score-circle ' + getScoreClass(score);
            
            updateTotalScore();
        }
        
        // æ›´æ–°è³ªåŒ–è©•åˆ†
        function updateQualitativeScore(moduleId, indicator, value) {
            const scoreSpan = event.target.nextElementSibling;
            scoreSpan.textContent = value;
            
            if (!qualitativeScores[moduleId]) {
                qualitativeScores[moduleId] = {};
            }
            qualitativeScores[moduleId][indicator] = parseInt(value);
            
            updateModuleScore(moduleId);
        }
        
        // ç²å–è©•åˆ†æ¨£å¼é¡åˆ¥
        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 70) return 'score-good';
            if (score >= 50) return 'score-average';
            return 'score-poor';
        }
        
        // æ›´æ–°ç¸½è©•åˆ†
        function updateTotalScore() {
            if (!selectedIndustry) return;
            
            const config = enhancedIndustryConfigs[selectedIndustry];
            let totalScore = 0;
            let hasAllScores = true;
            
            Object.keys(config.modules).forEach(moduleId => {
                if (moduleScores[moduleId] !== undefined) {
                    totalScore += moduleScores[moduleId] * (config.modules[moduleId].weight / 100);
                } else {
                    hasAllScores = false;
                }
            });
            
            if (hasAllScores) {
                totalScore = Math.round(totalScore);
                document.getElementById('totalScore').textContent = totalScore;
                updateRecommendation(totalScore);
                updateEnhancedValuation();
            }
        }
        
        // æ›´æ–°å»ºè­°
        function updateRecommendation(score) {
            const recDiv = document.getElementById('recommendation');
            let recClass, recText;
            
            if (score >= 75) {
                recClass = 'rec-buy';
                recText = 'ğŸŸ¢ å¼·çƒˆå»ºè­°è²·å…¥ - ç¬¦åˆé–‹å€‰æ¢ä»¶';
            } else if (score >= 50) {
                recClass = 'rec-hold';
                recText = 'ğŸŸ¡ æŒæœ‰è§€æœ› - ç­‰å¾…æ›´å¥½æ™‚æ©Ÿ';
            } else {
                recClass = 'rec-sell';
                recText = 'ğŸ”´ é¿å…æŠ•è³‡ - åŸºæœ¬é¢åå¼±';
            }
            
            recDiv.className = `recommendation ${recClass}`;
            recDiv.textContent = recText;
        }
        
        // æ›´æ–°ä¿¡å¿ƒæŒ‡æ•¸
        function updateConfidenceLevel() {
            const allQualScores = [];
            Object.values(qualitativeScores).forEach(moduleQual => {
                Object.values(moduleQual).forEach(score => {
                    allQualScores.push(score);
                });
            });
            
            confidenceLevel = allQualScores.length > 0 ? 
                Math.round(allQualScores.reduce((a, b) => a + b, 0) / allQualScores.length) : 50;
            
            document.getElementById('confidenceLevel').textContent = confidenceLevel;
        }
        
        // æ›´æ–°é¢¨éšªè©•ä¼°
        function updateRiskAssessment() {
            const sentiment = marketEnvironment.sentiment;
            const vix = parseFloat(document.getElementById('vixIndex').value) || 20;
            // é€™è£¡å¯ä»¥æ ¹æ“šæƒ…ç·’å’ŒVIXæ›´æ–°é¢¨éšªè©•ä¼°é‚è¼¯
        }
        
        // åŸ·è¡Œå…¨é¢åˆ†æ
        function calculateEnhancedAnalysis() {
            if (!selectedIndustry) {
                alert('è«‹å…ˆé¸æ“‡ç”¢æ¥­é¡åˆ¥');
                return;
            }
            
            updateTotalScore();
            updateEnhancedValuation();
            updateActionSuggestions();
            autoSaveAnalysis();
        }
        
        // å¢å¼·ä¼°å€¼è¨ˆç®—
        function updateEnhancedValuation() {
            const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 100;
            const totalScore = parseInt(document.getElementById('totalScore').textContent) || 0;
            
            if (!selectedIndustry) return;
            
            const config = enhancedIndustryConfigs[selectedIndustry];
            const valuation = config.valuation;
            
            // åŸºæ–¼è©•åˆ†èª¿æ•´ä¼°å€¼
            const scoreMultiplier = totalScore / 75; // 75åˆ†ç‚ºåŸºæº–
            const basePrice = currentPrice;
            
            // è¨ˆç®—å„æƒ…å¢ƒä¼°å€¼
            let pessimistic, neutral, optimistic;
            
            if (valuation.pessimistic.pe) {
                pessimistic = Math.round(basePrice * 0.8);
                neutral = Math.round(basePrice * 1.2 * scoreMultiplier);
                optimistic = Math.round(basePrice * 1.8 * scoreMultiplier);
            } else if (valuation.pessimistic.pb) {
                pessimistic = Math.round(basePrice * 0.7);
                neutral = Math.round(basePrice * 1.1 * scoreMultiplier);
                optimistic = Math.round(basePrice * 1.6 * scoreMultiplier);
            } else if (valuation.pessimistic.yield) {
                pessimistic = Math.round(basePrice * 0.8);
                neutral = Math.round(basePrice * 1.1 * scoreMultiplier);
                optimistic = Math.round(basePrice * 1.4 * scoreMultiplier);
            }
            
            document.getElementById('pessimisticPrice').textContent = `${pessimistic}`;
            document.getElementById('neutralPrice').textContent = `${neutral}`;
            document.getElementById('optimisticPrice').textContent = `${optimistic}`;
            
            document.getElementById('pessimisticAssumption').textContent = valuation.pessimistic.desc;
            document.getElementById('neutralAssumption').textContent = valuation.neutral.desc;
            document.getElementById('optimisticAssumption').textContent = valuation.optimistic.desc;
            
            // è’™åœ°å¡ç¾…æ¨¡æ“¬
            const monteCarloResult = runSimpleMonteCarlo(currentPrice, totalScore);
            document.getElementById('monteCarloPrice').textContent = 
                `${monteCarloResult.mean} Â± ${monteCarloResult.std}`;
        }
        
        // ç°¡åŒ–è’™åœ°å¡ç¾…æ¨¡æ“¬
        function runSimpleMonteCarlo(basePrice, score) {
            const simulations = 1000;
            const results = [];
            
            for (let i = 0; i < simulations; i++) {
                const randomFactor = (Math.random() - 0.5) * 0.6 + 1;
                const scoreFactor = (score / 75);
                const result = basePrice * randomFactor * scoreFactor;
                results.push(result);
            }
            
            const mean = Math.round(results.reduce((a, b) => a + b) / results.length);
            const variance = results.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / results.length;
            const std = Math.round(Math.sqrt(variance));
            
            return { mean, std };
        }
        
        // æ›´æ–°æ“ä½œå»ºè­°
        function updateActionSuggestions() {
            const totalScore = parseInt(document.getElementById('totalScore').textContent) || 0;
            const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 0;
            const suggestionsDiv = document.getElementById('actionSuggestions');
            
            if (totalScore >= 75) {
                suggestionsDiv.innerHTML = `
                    <div class="rec-buy" style="margin-bottom: 15px;">
                        <h3>ğŸ¯ é–‹å€‰ç­–ç•¥</h3>
                        <p>â€¢ é–‹å€‰åƒ¹ä½: ${currentPrice} (ç¸½è³‡é‡‘30%)</p>
                        <p>â€¢ ç¬¬ä¸€æ¬¡åŠ å€‰: ${Math.round(currentPrice * 0.85)} (ç¸½è³‡é‡‘40%)</p>
                        <p>â€¢ ç¬¬äºŒæ¬¡åŠ å€‰: ${Math.round(currentPrice * 0.75)} (ç¸½è³‡é‡‘30%)</p>
                    </div>
                    <div class="rec-buy">
                        <h3>ğŸ“ˆ ç›®æ¨™è¨­å®š</h3>
                        <p>â€¢ é æœŸæŒæœ‰æœŸé–“: 2-3å¹´</p>
                        <p>â€¢ ç›®æ¨™å ±é…¬ç‡: 100%</p>
                        <p>â€¢ æ­¢æé»: ${Math.round(currentPrice * 0.65)}</p>
                    </div>
                `;
            } else if (totalScore >= 50) {
                suggestionsDiv.innerHTML = `
                    <div class="rec-hold">
                        <h3>â³ è§€æœ›ç­–ç•¥</h3>
                        <p>â€¢ ç­‰å¾…åŸºæœ¬é¢æ”¹å–„æˆ–è‚¡åƒ¹æ›´å…·å¸å¼•åŠ›</p>
                        <p>â€¢ é—œæ³¨é—œéµæŒ‡æ¨™è®ŠåŒ–</p>
                        <p>â€¢ è€ƒæ…®åˆ†æ‰¹å°é‡å¸ƒå±€</p>
                    </div>
                `;
            } else {
                suggestionsDiv.innerHTML = `
                    <div class="rec-sell">
                        <h3>âŒ é¿å…æŠ•è³‡</h3>
                        <p>â€¢ åŸºæœ¬é¢è©•åˆ†éä½ï¼Œä¸ç¬¦åˆæŠ•è³‡æ¨™æº–</p>
                        <p>â€¢ å»ºè­°å°‹æ‰¾å…¶ä»–æŠ•è³‡æ¨™çš„</p>
                        <p>â€¢ è‹¥å·²æŒæœ‰ï¼Œè€ƒæ…®é€æ­¥æ¸›å€‰</p>
                    </div>
                `;
            }
        }
        
        // å£“åŠ›æ¸¬è©¦
        function runStressTest() {
            const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 100;
            
            const scenarios = [
                { name: 'é‡‘èå±æ©Ÿ', decline: 50 },
                { name: 'åˆ©ç‡æš´å‡', decline: 30 },
                { name: 'è¡Œæ¥­è¡°é€€', decline: 40 },
                { name: 'é»‘å¤©éµäº‹ä»¶', decline: 60 }
            ];
            
            let report = 'å£“åŠ›æ¸¬è©¦çµæœ:\n\n';
            scenarios.forEach(scenario => {
                const stressPrice = Math.round(currentPrice * (1 - scenario.decline / 100));
                report += `${scenario.name}: ${stressPrice} (è·Œå¹…${scenario.decline}%)\n`;
            });
            
            alert(report);
        }
        
        // è’™åœ°å¡ç¾…æ¨¡æ“¬
        function runMonteCarloSimulation() {
            const iterations = 10000;
            const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 100;
            const totalScore = parseInt(document.getElementById('totalScore').textContent) || 0;
            
            alert(`æ­£åœ¨åŸ·è¡Œ${iterations}æ¬¡è’™åœ°å¡ç¾…æ¨¡æ“¬...`);
            
            const results = [];
            for (let i = 0; i < iterations; i++) {
                const marketShock = (Math.random() - 0.5) * 0.8;
                const companyPerformance = (Math.random() - 0.5) * 0.4 + (totalScore - 75) / 75 * 0.3;
                const timeDecay = Math.random() * 0.1;
                
                const finalPrice = currentPrice * (1 + marketShock + companyPerformance - timeDecay);
                results.push(Math.max(finalPrice, currentPrice * 0.1));
            }
            
            results.sort((a, b) => a - b);
            const p5 = results[Math.floor(iterations * 0.05)];
            const p50 = results[Math.floor(iterations * 0.5)];
            const p95 = results[Math.floor(iterations * 0.95)];
            
            const report = `
è’™åœ°å¡ç¾…æ¨¡æ“¬çµæœ (${iterations}æ¬¡):
â€¢ 5%åˆ†ä½æ•¸: ${Math.round(p5)}
â€¢ ä¸­ä½æ•¸: ${Math.round(p50)}  
â€¢ 95%åˆ†ä½æ•¸: ${Math.round(p95)}
â€¢ VaR(95%): ${Math.round((currentPrice - p5) / currentPrice * 100)}%
            `;
            
            alert(report);
        }
        
        // AIåˆ†æ
        function runAIAnalysis() {
            setTimeout(() => {
                const insights = document.getElementById('aiInsights');
                insights.innerHTML = `
                    <p>ğŸ” AIåˆ†æå®Œæˆ:</p>
                    <ul>
                        <li>âœ… ç«¶çˆ­å„ªå‹¢: æŠ€è¡“è­·åŸæ²³æ·±åš</li>
                        <li>âš ï¸ ä¾›æ‡‰éˆé¢¨éšª: ä¸­ç­‰ç¨‹åº¦åœ°ç·£æ”¿æ²»é¢¨éšª</li>
                        <li>âœ… ESGè©•åˆ†: Bç´šï¼Œç¬¦åˆæŠ•è³‡æ¨™æº–</li>
                        <li>âš ï¸ ç›£ç®¡é¢¨éšª: åå£Ÿæ–·èª¿æŸ¥é—œæ³¨</li>
                        <li>âœ… å‰µæ–°èƒ½åŠ›: ç ”ç™¼æŠ•å…¥æŒçºŒå¢åŠ </li>
                    </ul>
                    <p><strong>AIå»ºè­°: è¬¹æ…æ¨‚è§€ï¼Œå»ºè­°åˆ†æ‰¹å»ºå€‰</strong></p>
                `;
            }, 2000);
        }
        
        // è‡ªå‹•ä¿å­˜åŠŸèƒ½
        function autoSaveAnalysis() {
            const analysisData = {
                exchange: selectedExchange,
                industry: selectedIndustry,
                stockCode: document.getElementById('stockCode').value,
                currentPrice: document.getElementById('currentPrice').value,
                marketCap: document.getElementById('marketCap').value,
                marketEnvironment: {
                    environment: selectedEnvironment,
                    interestRate: document.getElementById('interestRate').value,
                    inflation: document.getElementById('inflation').value,
                    gdpGrowth: document.getElementById('gdpGrowth').value,
                    usdTrend: document.getElementById('usdTrend').value,
                    vixIndex: document.getElementById('vixIndex').value
                },
                moduleScores: moduleScores,
                qualitativeScores: qualitativeScores,
                totalScore: document.getElementById('totalScore').textContent,
                confidenceLevel: document.getElementById('confidenceLevel').textContent
            };
            
            const saved = dataManager.saveAnalysis(analysisData);
            if (saved) {
                console.log('åˆ†æå·²è‡ªå‹•ä¿å­˜');
            }
        }
        
        // è¼‰å…¥ä¸Šæ¬¡åˆ†æ
        function loadLastAnalysis() {
            const lastAnalysis = dataManager.loadAnalysis();
            if (!lastAnalysis) return;
            
            // æ¢å¾©åŸºæœ¬æ•¸æ“š
            if (lastAnalysis.exchange) {
                document.getElementById('exchange').value = lastAnalysis.exchange;
                selectedExchange = lastAnalysis.exchange;
                updateCurrencyDisplay();
            }
            
            if (lastAnalysis.stockCode) {
                document.getElementById('stockCode').value = lastAnalysis.stockCode;
            }
            
            if (lastAnalysis.currentPrice) {
                document.getElementById('currentPrice').value = lastAnalysis.currentPrice;
            }
            
            if (lastAnalysis.marketCap) {
                document.getElementById('marketCap').value = lastAnalysis.marketCap;
                updateMarketCapDisplay();
            }
            
            // æ¢å¾©å¸‚å ´ç’°å¢ƒ
            if (lastAnalysis.marketEnvironment) {
                const env = lastAnalysis.marketEnvironment;
                if (env.environment) {
                    selectedEnvironment = env.environment;
                    document.querySelector(`[data-env="${env.environment}"]`)?.classList.add('selected');
                }
                
                ['interestRate', 'inflation', 'gdpGrowth', 'usdTrend', 'vixIndex'].forEach(field => {
                    if (env[field] && document.getElementById(field)) {
                        document.getElementById(field).value = env[field];
                    }
                });
            }
            
            // æ¢å¾©ç”¢æ¥­é¸æ“‡
            if (lastAnalysis.industry) {
                selectedIndustry = lastAnalysis.industry;
                document.querySelector(`[data-industry="${lastAnalysis.industry}"]`)?.classList.add('selected');
                generateEnhancedModules();
            }
            
            // æ¢å¾©è©•åˆ†
            if (lastAnalysis.moduleScores) {
                moduleScores = lastAnalysis.moduleScores;
            }
            
            if (lastAnalysis.qualitativeScores) {
                qualitativeScores = lastAnalysis.qualitativeScores;
            }
            
            // æ¢å¾©ç¸½è©•åˆ†
            if (lastAnalysis.totalScore && lastAnalysis.totalScore !== '--') {
                document.getElementById('totalScore').textContent = lastAnalysis.totalScore;
            }
            
            if (lastAnalysis.confidenceLevel && lastAnalysis.confidenceLevel !== '--') {
                document.getElementById('confidenceLevel').textContent = lastAnalysis.confidenceLevel;
            }
        }
        
        // é¡¯ç¤ºåˆ†ææ­·å²
        function showAnalysisHistory() {
            const backups = dataManager.getBackups();
            if (backups.length === 0) {
                alert('æš«ç„¡æ­·å²è¨˜éŒ„');
                return;
            }
            
            let historyHtml = '<h3>åˆ†ææ­·å²è¨˜éŒ„</h3><div style="max-height: 400px; overflow-y: auto;">';
            
            backups.reverse().forEach((backup, index) => {
                const date = new Date(backup.timestamp).toLocaleString();
                const stockCode = backup.data.stockCode || 'æœªçŸ¥';
                const score = backup.data.totalScore || '--';
                
                historyHtml += `
                    <div style="border: 1px solid #ddd; margin: 10px 0; padding: 10px; border-radius: 5px;">
                        <strong>${stockCode}</strong> - ${date}<br>
                        è©•åˆ†: ${score}/100<br>
                        <button onclick="loadHistoryRecord(${backups.length - 1 - index})" style="margin-top: 5px; padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 3px; cursor: pointer;">è¼‰å…¥æ­¤è¨˜éŒ„</button>
                    </div>
                `;
            });
            
            historyHtml += '</div>';
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 20px; border-radius: 10px; 
                max-width: 500px; width: 90%; max-height: 80%;
            `;
            content.innerHTML = historyHtml + '<button onclick="this.closest(\'.modal\').remove()" style="margin-top: 10px; padding: 8px 15px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer;">é—œé–‰</button>';
            
            modal.className = 'modal';
            modal.appendChild(content);
            document.body.appendChild(modal);
        }
        
        // è¼‰å…¥æ­·å²è¨˜éŒ„
        function loadHistoryRecord(index) {
            const backups = dataManager.getBackups();
            if (backups[index]) {
                dataManager.saveAnalysis(backups[index].data);
                location.reload();
            }
        }
        
        // å°å‡ºå€‹äººæ•¸æ“š
        function exportPersonalData() {
            const exportData = dataManager.exportAllData();
            const blob = new Blob([exportData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å€‹äººæŠ•è³‡åˆ†ææ•¸æ“š_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('å€‹äººæ•¸æ“šå·²å°å‡ºï¼å¯ç”¨æ–¼å‚™ä»½æˆ–è½‰ç§»åˆ°å…¶ä»–è¨­å‚™');
        }
        
        // å°å…¥å€‹äººæ•¸æ“š
        function importPersonalData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const success = dataManager.importData(e.target.result);
                            if (success) {
                                alert('æ•¸æ“šå°å…¥æˆåŠŸï¼é é¢å°‡é‡æ–°è¼‰å…¥');
                                location.reload();
                            } else {
                                alert('æ•¸æ“šå°å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ–‡ä»¶æ ¼å¼');
                            }
                        } catch (error) {
                            alert('æ•¸æ“šå°å…¥å¤±æ•—ï¼š' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // å°å‡ºè©³ç´°å ±å‘Š
        function exportEnhancedReport() {
            const stockCode = document.getElementById('stockCode').value;
            const exchange = document.getElementById('exchange').value;
            
            if (!stockCode || !selectedIndustry) {
                alert('è«‹å®Œæ•´å¡«å¯«è‚¡ç¥¨è³‡è¨Šä¸¦é¸æ“‡ç”¢æ¥­');
                return;
            }
            
            const report = generateDetailedReport();
            const blob = new Blob([report], { type: 'text/plain; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${stockCode}_${exchange.toUpperCase()}_æŠ•è³‡åˆ†æå ±å‘Š_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ç”Ÿæˆè©³ç´°å ±å‘Š
        function generateDetailedReport() {
            const stockCode = document.getElementById('stockCode').value;
            const exchange = document.getElementById('exchange').value;
            const currentPrice = document.getElementById('currentPrice').value;
            const marketCap = document.getElementById('marketCap').value;
            const totalScore = document.getElementById('totalScore').textContent;
            const confidenceLevel = document.getElementById('confidenceLevel').textContent;
            const industryName = enhancedIndustryConfigs[selectedIndustry]?.name || '';
            const currency = marketConfigs[exchange]?.currency || 'USD';
            
            return `
===============================================
         å€‹äººæŠ•è³‡åˆ†æå ±å‘Š v2.0
===============================================

è‚¡ç¥¨ä»£ç¢¼: ${stockCode} (${exchange.toUpperCase()})
ç•¶å‰è‚¡åƒ¹: ${currentPrice} ${currency}
å¸‚å€¼: ${marketCap} å„„${currency}
ç”¢æ¥­é¡åˆ¥: ${industryName}
åˆ†ææ—¥æœŸ: ${new Date().toLocaleDateString()}
å¸‚å ´ç’°å¢ƒ: ${selectedEnvironment || 'æœªé¸æ“‡'}

===============================================
         ç¶œåˆè©•åˆ†çµæœ
===============================================

ç¸½è©•åˆ†: ${totalScore}/100
ä¿¡å¿ƒæŒ‡æ•¸: ${confidenceLevel}%

===============================================
         å¤šæƒ…å¢ƒä¼°å€¼åˆ†æ
===============================================

æ‚²è§€æƒ…å¢ƒ: ${document.getElementById('pessimisticPrice')?.textContent || '--'}
ä¸­ç«‹æƒ…å¢ƒ: ${document.getElementById('neutralPrice')?.textContent || '--'}
æ¨‚è§€æƒ…å¢ƒ: ${document.getElementById('optimisticPrice')?.textContent || '--'}
è’™åœ°å¡ç¾…æ¨¡æ“¬: ${document.getElementById('monteCarloPrice')?.textContent || '--'}

===============================================
         æŠ•è³‡å»ºè­°
===============================================

${document.getElementById('recommendation')?.textContent || ''}

===============================================
         å…è²¬è²æ˜
===============================================

æœ¬å ±å‘Šåƒ…ä¾›å€‹äººæŠ•è³‡åƒè€ƒï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°ã€‚
æŠ•è³‡æœ‰é¢¨éšªï¼Œæ±ºç­–éœ€è¬¹æ…ã€‚
éå»ç¸¾æ•ˆä¸ä»£è¡¨æœªä¾†è¡¨ç¾ã€‚

===============================================
å ±å‘ŠçµæŸ - ç³»çµ±ç‰ˆæœ¬ v2.0
===============================================
            `;
        }
        
        // è¨­å®šåƒ¹æ ¼è­¦å ±
        function setPriceAlert() {
            const alertPrice = document.getElementById('priceAlert').value;
            const stockCode = document.getElementById('stockCode').value;
            
            if (alertPrice && stockCode) {
                alert(`åƒ¹æ ¼è­¦å ±å·²è¨­å®š: ${stockCode} ç›®æ¨™åƒ¹æ ¼ ${alertPrice}`);
            } else {
                alert('è«‹å…ˆè¼¸å…¥è‚¡ç¥¨ä»£ç¢¼å’Œç›®æ¨™åƒ¹æ ¼');
            }
        }
        
        // é‡è¨­æ‰€æœ‰
        function resetAll() {
            if (confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) {
                // æ¸…é™¤æ‰€æœ‰è¼¸å…¥
                document.getElementById('exchange').value = 'us';
                document.getElementById('stockCode').value = '';
                document.getElementById('currentPrice').value = '';
                document.getElementById('marketCap').value = '';
                document.getElementById('vixIndex').value = '';
                
                // é‡è¨­é¸æ“‡ç‹€æ…‹
                document.querySelectorAll('.env-card').forEach(c => c.classList.remove('selected'));
                document.querySelectorAll('.sentiment-option').forEach(o => o.classList.remove('selected'));
                document.querySelectorAll('.industry-card').forEach(c => c.classList.remove('selected'));
                
                // é‡è¨­æ¨¡çµ„
                document.getElementById('moduleGrid').innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">è«‹å…ˆé¸æ“‡ç”¢æ¥­é¡åˆ¥ä»¥é¡¯ç¤ºè©•åˆ†æ¨¡çµ„</p>';
                
                // é‡è¨­è©•åˆ†
                document.getElementById('totalScore').textContent = '--';
                document.getElementById('confidenceLevel').textContent = '--';
                document.getElementById('recommendation').textContent = 'è«‹å…ˆå®Œæˆæ‰€æœ‰è©•ä¼°';
                document.getElementById('actionSuggestions').innerHTML = '<p>è«‹å®Œæˆè©•åˆ†å¾ŒæŸ¥çœ‹æ“ä½œå»ºè­°</p>';
                
                // é‡è¨­ä¼°å€¼
                ['pessimistic', 'neutral', 'optimistic', 'monteCarlo'].forEach(scenario => {
                    const priceElement = document.getElementById(`${scenario}Price`);
                    if (priceElement) priceElement.textContent = '--';
                });
                
                // é‡è¨­è³ªåŒ–åˆ†æ
                ['ceoLeadership', 'strategy', 'innovation', 'brandValue'].forEach(id => {
                    const slider = document.getElementById(id);
                    if (slider) slider.value = 50;
                    const display = document.getElementById(id.replace(/([A-Z])/g, '') + 'Value') || 
                                   document.getElementById(id + 'Score');
                    if (display) display.textContent = '50';
                });
                
                // é‡è¨­é–‹é—œ
                document.getElementById('aiAnalysis').checked = false;
                document.getElementById('realTimeMonitoring').checked = false;
                document.getElementById('aiInsights').style.display = 'none';
                
                // é‡è¨­è®Šæ•¸
                selectedIndustry = null;
                selectedEnvironment = null;
                selectedExchange = 'us';
                moduleScores = {};
                qualitativeScores = {};
                marketEnvironment = {};
                confidenceLevel = 50;
                
                // æ›´æ–°é¡¯ç¤º
                updateCurrencyDisplay();
                alert('æ‰€æœ‰è³‡æ–™å·²é‡è¨­å®Œæˆï¼');
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥ä¸Šæ¬¡åˆ†æ
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrencyDisplay();
            updateMarketCapDisplay();
            loadLastAnalysis();
        });
        
        // è‡ªå‹•ä¿å­˜äº‹ä»¶ç›£è½
        ['change', 'input'].forEach(eventType => {
            document.addEventListener(eventType, function(e) {
                if (e.target.matches('#stockCode, #currentPrice, #marketCap, #exchange')) {
                    setTimeout(autoSaveAnalysis, 500);
                }
            });
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="æŠ•è³‡åˆ†æå·¥å…·">
    <title>å€‹äººæŠ•è³‡åˆ†æå·¥å…· v2.0</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>ğŸ“Š</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 2.2em;
            font-weight: 300;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .section {
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .section h2 {
            color: #4a5568;
            margin-bottom: 15px;
            border-bottom: 3px solid #e2e8f0;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
        }
        
        .new-feature {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .enhanced-feature {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        input, select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .market-environment {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .env-card {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            font-size: 14px;
        }
        
        .env-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        .env-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .industry-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .industry-card {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        }
        
        .industry-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        .industry-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .industry-card h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .industry-card p {
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .industry-card small {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .dynamic-weights {
            background: linear-gradient(135deg, #fef3c7, #f59e0b);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            color: #92400e;
            font-weight: 600;
            font-size: 14px;
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .module {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            background: linear-gradient(135deg, #fff, #f8fafc);
            position: relative;
            overflow: hidden;
        }
        
        .module::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .module h3 {
            color: #4a5568;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }
        
        .weight-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .score-display {
            text-align: center;
            margin: 10px 0;
        }
        
        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin: 8px;
        }
        
        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #17a2b8, #6f42c1); }
        .score-average { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e83e8c); }
        
        .indicator-list h4 {
            font-size: 14px;
            color: #4a5568;
            margin: 10px 0 5px 0;
        }
        
        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .indicator-item span {
            flex: 1;
            margin-right: 8px;
        }
        
        .indicator-item input {
            width: 70px;
            padding: 4px;
            font-size: 12px;
        }
        
        .confidence-slider {
            width: 60px;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .confidence-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
        }
        
        .qual-score {
            font-weight: bold;
            color: #667eea;
            min-width: 25px;
            text-align: center;
        }
        
        .qualitative-section {
            margin-top: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }
        
        .qualitative-section h3 {
            color: #065f46;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .macro-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .macro-card {
            padding: 12px;
            background: linear-gradient(135deg, #fef7ff, #f3e8ff);
            border-radius: 8px;
            border: 1px solid #e9d5ff;
            text-align: center;
        }
        
        .macro-card h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #4c1d95;
        }
        
        .sentiment-meter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 8px;
            background: linear-gradient(135deg, #f0f9ff, #dbeafe);
            border-radius: 8px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .sentiment-option {
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 12px;
            flex: 1;
            text-align: center;
            min-width: 80px;
        }
        
        .sentiment-option.bearish {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .sentiment-option.neutral {
            background: #fef3c7;
            color: #d97706;
        }
        
        .sentiment-option.bullish {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .sentiment-option.selected {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .total-score {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .total-score h2 {
            font-size: 3em;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        
        .confidence-display {
            margin-top: 10px;
            font-size: 1.1em;
            position: relative;
            z-index: 1;
        }
        
        .recommendation {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .rec-buy { background: linear-gradient(135deg, #d4edda, #c3e6cb); color: #155724; }
        .rec-hold { background: linear-gradient(135deg, #fff3cd, #ffeaa7); color: #856404; }
        .rec-sell { background: linear-gradient(135deg, #f8d7da, #f5c6cb); color: #721c24; }
        
        .enhanced-valuation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .valuation-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .pessimistic { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .neutral { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .optimistic { background: linear-gradient(135deg, #10b981, #059669); }
        .monte-carlo { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        
        .scenario-probability {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            border-radius: 28px;
            transition: .4s;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        
        .ai-insights {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #38bdf8;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .ai-insights h3 {
            color: #0c4a6e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .mobile-guide {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .mobile-step {
            padding: 12px;
            border-radius: 8px;
        }
        
        .ios-guide {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }
        
        .android-guide {
            background: linear-gradient(135deg, #fef3c7, #fcd34d);
        }
        
        .security-guide {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
        }
        
        .mobile-step h4 {
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .mobile-step ol, .mobile-step ul {
            font-size: 13px;
            margin: 8px 0;
            padding-left: 18px;
        }
        
        .mobile-step small {
            font-size: 11px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .input-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .industry-selector {
                grid-template-columns: 1fr;
            }
            
            .module-grid {
                grid-template-columns: 1fr;
            }
            
            .enhanced-valuation {
                grid-template-columns: 1fr;
            }
            
            .sentiment-meter {
                flex-direction: column;
                gap: 8px;
            }
            
            .sentiment-option {
                min-width: 120px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .macro-indicators {
                grid-template-columns: 1fr;
            }
            
            .market-environment {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š å€‹äººæŠ•è³‡åˆ†æå·¥å…· <span class="version-badge">v2.0</span></h1>
        
        <!-- å¸‚å ´ç’°å¢ƒè©•ä¼° -->
        <div class="section">
            <h2>ğŸŒ å¸‚å ´ç’°å¢ƒè©•ä¼° <span class="new-feature">NEW</span></h2>
            <div class="market-environment">
                <div class="env-card" data-env="bull">
                    <h3>ğŸ‚ ç‰›å¸‚ç’°å¢ƒ</h3>
                    <p>ä½åˆ©ç‡ã€é«˜æµå‹•æ€§</p>
                </div>
                <div class="env-card" data-env="bear">
                    <h3>ğŸ» ç†Šå¸‚ç’°å¢ƒ</h3>
                    <p>é«˜åˆ©ç‡ã€ç·Šç¸®æ”¿ç­–</p>
                </div>
                <div class="env-card" data-env="neutral">
                    <h3>âš–ï¸ ä¸­æ€§ç’°å¢ƒ</h3>
                    <p>å¹³è¡¡çš„è²¨å¹£æ”¿ç­–</p>
                </div>
                <div class="env-card" data-env="volatile">
                    <h3>âš¡ æ³¢å‹•ç’°å¢ƒ</h3>
                    <p>åœ°ç·£æ”¿æ²»é¢¨éšª</p>
                </div>
            </div>
            
            <div class="macro-indicators">
                <div class="macro-card">
                    <h4>åˆ©ç‡ç’°å¢ƒ</h4>
                    <select id="interestRate">
                        <option value="low">ä½åˆ©ç‡ (0-2%)</option>
                        <option value="medium" selected>ä¸­æ€§åˆ©ç‡ (2-4%)</option>
                        <option value="high">é«˜åˆ©ç‡ (4%+)</option>
                    </select>
                </div>
                <div class="macro-card">
                    <h4>é€šè„¹æ°´æº–</h4>
                    <select id="inflation">
                        <option value="low">ä½é€šè„¹ (<2%)</option>
                        <option value="target" selected>ç›®æ¨™é€šè„¹ (2-3%)</option>
                        <option value="high">é«˜é€šè„¹ (>3%)</option>
                    </select>
                </div>
                <div class="macro-card">
                    <h4>ç¶“æ¿Ÿæˆé•·</h4>
                    <select id="gdpGrowth">
                        <option value="recession">è¡°é€€ (<0%)</option>
                        <option value="slow">ç·©æ…¢æˆé•· (0-2%)</option>
                        <option value="moderate" selected>ç©©å¥æˆé•· (2-4%)</option>
                        <option value="strong">å¼·å‹æˆé•· (>4%)</option>
                    </select>
                </div>
                <div class="macro-card">
                    <h4>ç¾å…ƒèµ°å‹¢</h4>
                    <select id="usdTrend">
                        <option value="weak">ç¾å…ƒèµ°å¼±</option>
                        <option value="stable" selected>ç¾å…ƒç©©å®š</option>
                        <option value="strong">ç¾å…ƒèµ°å¼·</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- å¸‚å ´æƒ…ç·’åˆ†æ -->
        <div class="section">
            <h2>ğŸ“ˆ å¸‚å ´æƒ…ç·’åˆ†æ <span class="new-feature">NEW</span></h2>
            <div class="sentiment-meter">
                <div class="sentiment-option bearish" data-sentiment="bearish">æ¥µåº¦æ‚²è§€</div>
                <div class="sentiment-option bearish" data-sentiment="pessimistic">æ‚²è§€</div>
                <div class="sentiment-option neutral" data-sentiment="neutral">ä¸­æ€§</div>
                <div class="sentiment-option bullish" data-sentiment="optimistic">æ¨‚è§€</div>
                <div class="sentiment-option bullish" data-sentiment="euphoric">æ¥µåº¦æ¨‚è§€</div>
            </div>
            <div class="input-group">
                <label>VIXææ…ŒæŒ‡æ•¸:</label>
                <input type="number" id="vixIndex" placeholder="è¼¸å…¥VIXæ•¸å€¼" min="10" max="80">
                <span id="vixInterpretation">--</span>
            </div>
        </div>
        
        <!-- åŸºæœ¬è³‡è¨Šè¼¸å…¥ -->
        <div class="section">
            <h2>ğŸ¢ åŸºæœ¬è³‡è¨Š</h2>
            <div class="input-group">
                <label>äº¤æ˜“æ‰€:</label>
                <select id="exchange">
                    <option value="us">ç¾è‚¡ (US)</option>
                    <option value="tw">å°è‚¡ (TW)</option>
                    <option value="hk">æ¸¯è‚¡ (HK)</option>
                    <option value="other">å…¶ä»–</option>
                </select>
                <span></span>
            </div>
            <div class="input-group">
                <label>è‚¡ç¥¨ä»£ç¢¼:</label>
                <input type="text" id="stockCode" placeholder="å¦‚: AAPL, 2330, 00878">
                <span></span>
            </div>
            <div class="input-group">
                <label>ç•¶å‰è‚¡åƒ¹:</label>
                <input type="number" id="currentPrice" placeholder="è¼¸å…¥ç•¶å‰è‚¡åƒ¹" step="0.01">
                <span id="currencyDisplay">USD</span>
            </div>
            <div class="input-group">
                <label>å¸‚å€¼:</label>
                <input type="number" id="marketCap" placeholder="è¼¸å…¥å¸‚å€¼" step="0.1">
                <span id="marketCapDisplay">å„„USD</span>
            </div>
            <div class="input-group">
                <label>å¸‚å€¼è¦æ¨¡:</label>
                <span id="marketCapSize">--</span>
                <span></span>
            </div>
        </div>
        
        <!-- ç”¢æ¥­é¸æ“‡ -->
        <div class="section">
            <h2>ğŸ­ ç”¢æ¥­é¡åˆ¥é¸æ“‡ <span class="enhanced-feature">ENHANCED</span></h2>
            <div class="dynamic-weights">
                âš¡ å‹•æ…‹æ¬Šé‡ï¼šç³»çµ±å°‡æ ¹æ“šå¸‚å ´ç’°å¢ƒè‡ªå‹•èª¿æ•´å„æ¨¡çµ„æ¬Šé‡
            </div>
            <div class="industry-selector">
                <div class="industry-card" data-industry="tech">
                    <h3>ğŸ’» ç§‘æŠ€æˆé•·å‹</h3>
                    <p>è»Ÿé«”ã€åŠå°é«”ã€é›»å•†</p>
                    <small>åˆ©ç‡æ•æ„Ÿåº¦ï¼šé«˜</small>
                </div>
                <div class="industry-card" data-industry="cyclical">
                    <h3>ğŸ”„ é€±æœŸå‹</h3>
                    <p>é‹¼éµã€åŒ–å·¥ã€èˆªé‹</p>
                    <small>ç¶“æ¿Ÿæ•æ„Ÿåº¦ï¼šæ¥µé«˜</small>
                </div>
                <div class="industry-card" data-industry="defensive">
                    <h3>ğŸ›¡ï¸ é˜²ç¦¦å‹</h3>
                    <p>å…¬ç”¨äº‹æ¥­ã€é£Ÿå“ã€é›»ä¿¡</p>
                    <small>æŠ—é¢¨éšªèƒ½åŠ›ï¼šé«˜</small>
                </div>
                <div class="industry-card" data-industry="financial">
                    <h3>ğŸ¦ é‡‘èå‹</h3>
                    <p>éŠ€è¡Œã€ä¿éšªã€è­‰åˆ¸</p>
                    <small>åˆ©ç‡å—ç›Šåº¦ï¼šé«˜</small>
                </div>
                <div class="industry-card" data-industry="capital">
                    <h3>ğŸ—ï¸ è³‡æœ¬å¯†é›†å‹</h3>
                    <p>æˆ¿åœ°ç”¢ã€åŸºå»ºã€èƒ½æº</p>
                    <small>é€šè„¹å°æ²–ï¼šä¸­ç­‰</small>
                </div>
                <div class="industry-card" data-industry="consumer">
                    <h3>ğŸ›ï¸ æ¶ˆè²»å‹</h3>
                    <p>é›¶å”®ã€é¤é£²ã€å¥¢ä¾ˆå“</p>
                    <small>æ¶ˆè²»åŠ›æ•æ„Ÿåº¦ï¼šé«˜</small>
                </div>
            </div>
        </div>
        
        <!-- è©•åˆ†æ¨¡çµ„ -->
        <div class="section">
            <h2>ğŸ“ˆ è©•åˆ†æ¨¡çµ„ <span class="enhanced-feature">ENHANCED</span></h2>
            <div class="module-grid" id="moduleGrid">
                <p style="text-align: center; color: #6b7280; padding: 40px;">è«‹å…ˆé¸æ“‡ç”¢æ¥­é¡åˆ¥ä»¥é¡¯ç¤ºè©•åˆ†æ¨¡çµ„</p>
            </div>
        </div>
        
        <!-- è³ªåŒ–åˆ†æ -->
        <div class="section">
            <h2>ğŸ¯ è³ªåŒ–åˆ†æ <span class="new-feature">NEW</span></h2>
            <div class="qualitative-section">
                <h3>ç®¡ç†å±¤è³ªé‡è©•ä¼°</h3>
                <div class="input-group">
                    <label>CEOé ˜å°åŠ›:</label>
                    <input type="range" min="0" max="100" value="50" class="confidence-slider" id="ceoLeadership">
                    <span id="ceoValue">50</span>
                </div>
                <div class="input-group">
                    <label>æˆ°ç•¥åŸ·è¡ŒåŠ›:</label>
                    <input type="range" min="0" max="100" value="50" class="confidence-slider" id="strategy">
                    <span id="strategyValue">50</span>
                </div>
                <div class="input-group">
                    <label>å‰µæ–°èƒ½åŠ›:</label>
                    <input type="range" min="0" max="100" value="50" class="confidence-slider" id="innovation">
                    <span id="innovationValue">50</span>
                </div>
                <div class="input-group">
                    <label>å“ç‰Œåƒ¹å€¼:</label>
                    <input type="range" min="0" max="100" value="50" class="confidence-slider" id="brandValue">
                    <span id="brandValueScore">50</span>
                </div>
            </div>
        </div>
        
        <!-- AIè¼”åŠ©åˆ†æ -->
        <div class="section">
            <h2>ğŸ¤– AIè¼”åŠ©åˆ†æ <span class="new-feature">NEW</span></h2>
            <div class="ai-insights">
                <h3>ğŸ§  æ™ºèƒ½é¢¨éšªè­˜åˆ¥</h3>
                <div class="input-group">
                    <label>å•Ÿç”¨AIåˆ†æ:</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="aiAnalysis">
                        <span class="slider"></span>
                    </label>
                    <span></span>
                </div>
                <div id="aiInsights" style="display: none;">
                    <p>ğŸ” AIæ­£åœ¨åˆ†æä»¥ä¸‹é¢¨éšªå› å­...</p>
                    <ul>
                        <li>ç«¶çˆ­å°æ‰‹å‹•æ…‹åˆ†æ</li>
                        <li>ä¾›æ‡‰éˆé¢¨éšªè©•ä¼°</li>
                        <li>ç›£ç®¡æ”¿ç­–å½±éŸ¿</li>
                        <li>æŠ€è¡“æ›¿ä»£é¢¨éšª</li>
                        <li>ESGé¢¨éšªè©•ä¼°</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- ç¸½è©•åˆ† -->
        <div class="total-score">
            <h2 id="totalScore">--</h2>
            <p>ç¸½è©•åˆ†</p>
            <div class="confidence-display">
                ä¿¡å¿ƒæŒ‡æ•¸: <span id="confidenceLevel">--</span>%
            </div>
            <div class="recommendation" id="recommendation">
                è«‹å…ˆå®Œæˆæ‰€æœ‰è©•ä¼°
            </div>
        </div>
        
        <!-- ä¼°å€¼æ¨¡å‹ -->
        <div class="section">
            <h2>ğŸ’° ä¸‰æƒ…å¢ƒä¼°å€¼æ¨¡å‹ <span class="enhanced-feature">ENHANCED</span></h2>
            <div class="enhanced-valuation">
                <div class="valuation-card pessimistic">
                    <h3>æ‚²è§€æƒ…å¢ƒ</h3>
                    <div class="scenario-probability">æ©Ÿç‡: <span id="pessimisticProb">30%</span></div>
                    <p id="pessimisticPrice">--</p>
                    <small id="pessimisticAssumption">--</small>
                </div>
                <div class="valuation-card neutral">
                    <h3>ä¸­ç«‹æƒ…å¢ƒ</h3>
                    <div class="scenario-probability">æ©Ÿç‡: <span id="neutralProb">50%</span></div>
                    <p id="neutralPrice">--</p>
                    <small id="neutralAssumption">--</small>
                </div>
                <div class="valuation-card optimistic">
                    <h3>æ¨‚è§€æƒ…å¢ƒ</h3>
                    <div class="scenario-probability">æ©Ÿç‡: <span id="optimisticProb">20%</span></div>
                    <p id="optimisticPrice">--</p>
                    <small id="optimisticAssumption">--</small>
                </div>
                <div class="valuation-card monte-carlo">
                    <h3>è’™åœ°å¡ç¾…æ¨¡æ“¬</h3>
                    <div class="scenario-probability">10,000æ¬¡æ¨¡æ“¬</div>
                    <p id="monteCarloPrice">--</p>
                    <small>æœŸæœ›å€¼ Â± æ¨™æº–å·®</small>
                </div>
            </div>
        </div>
        
        <!-- æ“ä½œå»ºè­° -->
        <div class="section">
            <h2>ğŸ¯ æ“ä½œå»ºè­° <span class="enhanced-feature">ENHANCED</span></h2>
            <div id="actionSuggestions">
                <p>è«‹å®Œæˆè©•åˆ†å¾ŒæŸ¥çœ‹æ“ä½œå»ºè­°</p>
            </div>
            
            <div class="input-group">
                <label>æŠ•è³‡æ™‚é–“è»¸:</label>
                <select id="timeHorizon">
                    <option value="short">çŸ­æœŸ (6å€‹æœˆå…§)</option>
                    <option value="medium" selected>ä¸­æœŸ (1-2å¹´)</option>
                    <option value="long">é•·æœŸ (3-5å¹´)</option>
                    <option value="forever">æ°¸ä¹…æŒæœ‰</option>
                </select>
                <span></span>
            </div>
            
            <div class="input-group">
                <label>é¢¨éšªæ‰¿å—åº¦:</label>
                <select id="riskTolerance">
                    <option value="conservative">ä¿å®ˆå‹</option>
                    <option value="moderate" selected>ç©©å¥å‹</option>
                    <option value="aggressive">ç©æ¥µå‹</option>
                    <option value="speculative">æŠ•æ©Ÿå‹</option>
                </select>
                <span></span>
            </div>
        </div>
        
        <!-- å€‹äººæ•¸æ“šç®¡ç† -->
        <div class="section">
            <h2>ğŸ’¾ å€‹äººæ•¸æ“šç®¡ç† <span class="new-feature">NEW</span></h2>
            <div class="action-buttons">
                <button class="btn-success" onclick="autoSaveAnalysis()">ğŸ’¾ æ‰‹å‹•ä¿å­˜</button>
                <button class="btn-secondary" onclick="showAnalysisHistory()">ğŸ“‹ åˆ†ææ­·å²</button>
                <button class="btn-primary" onclick="exportPersonalData()">ğŸ“¤ å°å‡ºæ•¸æ“š</button>
                <button class="btn-warning" onclick="importPersonalData()">ğŸ“¥ å°å…¥æ•¸æ“š</button>
            </div>
            <div style="margin-top: 15px; padding: 12px; background: #f0f9ff; border-radius: 8px;">
                <h4>ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</h4>
                <ul style="margin: 8px 0; padding-left: 18px; font-size: 13px;">
                    <li>ç³»çµ±æœƒè‡ªå‹•ä¿å­˜æ‚¨çš„åˆ†æè¨˜éŒ„</li>
                    <li>å®šæœŸå°å‡ºæ•¸æ“šå‚™ä»½ï¼Œé¿å…ç€è¦½å™¨æ¸…é™¤æ•¸æ“š</li>
                    <li>å¯åœ¨ä¸åŒè¨­å‚™é–“å°å…¥/å°å‡ºæ•¸æ“š</li>
                    <li>æ­·å²è¨˜éŒ„æœ€å¤šä¿ç•™10ç­†</li>
                </ul>
            </div>
        </div>
        
        <!-- æ‰‹æ©Ÿä½¿ç”¨æŒ‡å— -->
        <div class="section">
            <h2>ğŸ“± æ‰‹æ©Ÿä½¿ç”¨æŒ‡å— <span class="new-feature">NEW</span></h2>
            <div class="mobile-guide">
                <div class="mobile-step ios-guide">
                    <h4>ğŸ iPhone ç”¨æˆ¶</h4>
                    <ol>
                        <li>ç”¨ Safari é–‹å•Ÿæ­¤é é¢</li>
                        <li>é»æ“Šåº•éƒ¨ã€Œåˆ†äº«ã€æŒ‰éˆ•</li>
                        <li>é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</li>
                        <li>è¨­å®šåç¨±å¾Œç¢ºèª</li>
                    </ol>
                    <small>å»ºè­°åç¨±ï¼šæŠ•è³‡åˆ†æå·¥å…·</small>
                </div>
                
                <div class="mobile-step android-guide">
                    <h4>ğŸ¤– Android ç”¨æˆ¶</h4>
                    <ol>
                        <li>ç”¨ Chrome é–‹å•Ÿæ­¤é é¢</li>
                        <li>é»æ“Šå³ä¸Šè§’ã€Œâ‹®ã€é¸å–®</li>
                        <li>é¸æ“‡ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€</li>
                        <li>ç¢ºèªæ·»åŠ </li>
                    </ol>
                    <small>å¦‚åŒåŸç”ŸAPPèˆ¬ä½¿ç”¨</small>
                </div>
                
                <div class="mobile-step security-guide">
                    <h4>ğŸ’¾ æ•¸æ“šå®‰å…¨</h4>
                    <ul>
                        <li>å®šæœŸå°å‡ºæ•¸æ“šå‚™ä»½</li>
                        <li>æ¸…é™¤ç€è¦½å™¨å‰å…ˆå‚™ä»½</li>
                        <li>å¯åœ¨å¤šè¨­å‚™é–“åŒæ­¥</li>
                        <li>æœ¬åœ°å­˜å„²ï¼Œéš±ç§å®‰å…¨</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æŒ‰éˆ• -->
        <div class="action-buttons">
            <button class="btn-primary" onclick="calculateEnhancedAnalysis()">ğŸš€ é–‹å§‹å…¨é¢åˆ†æ</button>
            <button class="btn-secondary" onclick="runStressTest()">ğŸ§ª åŸ·è¡Œå£“åŠ›æ¸¬è©¦</button>
            <button class="btn-success" onclick="exportEnhancedReport()">ğŸ“Š å°å‡ºè©³ç´°å ±å‘Š</button>
            <button class="btn-warning" onclick="runMonteCarloSimulation()">ğŸ² è’™åœ°å¡ç¾…æ¨¡æ“¬</button>
            <button class="btn-secondary" onclick="resetAll()">ğŸ”„ é‡è¨­æ‰€æœ‰</button>
        </div>
        
        <!-- å³æ™‚ç›£æ§è¨­å®š -->
        <div class="section">
            <h2>â° å³æ™‚ç›£æ§è¨­å®š <span class="new-feature">NEW</span></h2>
            <div class="input-group">
                <label>å•Ÿç”¨å³æ™‚ç›£æ§:</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="realTimeMonitoring">
                    <span class="slider"></span>
                </label>
                <span>æ¯æ—¥æ›´æ–°åŸºæœ¬é¢æ•¸æ“š</span>
            </div>
            <div class="input-group">
                <label>åƒ¹æ ¼è­¦å ±è¨­å®š:</label>
                <input type="number" id="priceAlert" placeholder="ç›®æ¨™åƒ¹æ ¼">
                <button class="btn-primary" onclick="setPriceAlert()">è¨­å®šè­¦å ±</button>
            </div>
        </div>
    </div>
    
    <script>
        // é€šç”¨å¸‚å ´é…ç½®
        const marketConfigs = {
            us: {
                currency: 'USD',
                marketCapLevels: {
                    small: { min: 0, max: 20, label: 'å°å‹è‚¡' },
                    mid: { min: 20, max: 100, label: 'ä¸­å‹è‚¡' }, 
                    large: { min: 100, max: Infinity, label: 'å¤§å‹è‚¡' }
                }
            },
            tw: {
                currency: 'TWD',
                marketCapLevels: {
                    small: { min: 0, max: 100, label: 'å°å‹è‚¡' },
                    mid: { min: 100, max: 500, label: 'ä¸­å‹è‚¡' },
                    large: { min: 500, max: Infinity, label: 'å¤§å‹è‚¡' }
                }
            },
            hk: {
                currency: 'HKD', 
                marketCapLevels: {
                    small: { min: 0, max: 20, label: 'å°å‹è‚¡' },
                    mid: { min: 20, max: 100, label: 'ä¸­å‹è‚¡' },
                    large: { min: 100, max: Infinity, label: 'å¤§å‹è‚¡' }
                }
            }
        };
        
        // ç”¢æ¥­é…ç½®
        const enhancedIndustryConfigs = {
            tech: {
                name: 'ç§‘æŠ€æˆé•·å‹',
                baseWeights: { growth: 40, profitability: 30, valuation: 20, health: 10 },
                modules: {
                    growth: { 
                        weight: 40, 
                        name: 'æˆé•·æ€§', 
                        indicators: ['ç‡Ÿæ”¶æˆé•·ç‡', 'ç ”ç™¼è²»ç”¨æ¯”', 'æ–°ç”¢å“ç‡Ÿæ”¶å æ¯”', 'ç”¨æˆ¶å¢é•·ç‡'],
                        qualitative: ['æŠ€è¡“å‰µæ–°èƒ½åŠ›', 'å¸‚å ´é ˜å…ˆåœ°ä½', 'äººæ‰å¸å¼•åŠ›']
                    },
                    profitability: { 
                        weight: 30, 
                        name: 'ç›ˆåˆ©èƒ½åŠ›', 
                        indicators: ['æ¯›åˆ©ç‡', 'ROE', 'ROA', 'æ·¨åˆ©ç‡'],
                        qualitative: ['å•†æ¥­æ¨¡å¼å¼·åº¦', 'å®šåƒ¹èƒ½åŠ›', 'æˆæœ¬æ§åˆ¶']
                    },
                    valuation: { 
                        weight: 20, 
                        name: 'ä¼°å€¼', 
                        indicators: ['PEG', 'P/S', 'EV/Revenue', 'P/FCF'],
                        qualitative: ['å¸‚å ´é æœŸ', 'æˆé•·æŒçºŒæ€§', 'ç«¶çˆ­å„ªå‹¢']
                    },
                    health: { 
                        weight: 10, 
                        name: 'è²¡å‹™å¥åº·', 
                        indicators: ['ç¾é‡‘æ¯”', 'è² å‚µç‡', 'æµå‹•æ¯”ç‡', 'ç‡’éŒ¢ç‡'],
                        qualitative: ['è³‡é‡‘ä¾†æº', 'èè³‡èƒ½åŠ›', 'ç¾é‡‘ç®¡ç†']
                    }
                },
                valuation: {
                    pessimistic: { pe: 15, desc: 'P/E=15x, åˆ©ç‡ä¸Šå‡+ç«¶çˆ­åŠ åŠ‡' },
                    neutral: { pe: 25, desc: 'P/E=25x, ç©©å®šæˆé•·è»Œé“' },
                    optimistic: { pe: 40, desc: 'P/E=40x, AIé©å‘½æ€§çªç ´' }
                }
            },
            cyclical: {
                name: 'é€±æœŸå‹',
                baseWeights: { health: 40, valuation: 30, profitability: 20, growth: 10 },
                modules: {
                    health: { 
                        weight: 40, 
                        name: 'è²¡å‹™å¥åº·', 
                        indicators: ['è² å‚µç‡', 'ç¾é‡‘æ¯”', 'ç‡Ÿé‹ç¾é‡‘æµ', 'æ·¨ç¾é‡‘æ¯”ç‡'],
                        qualitative: ['ç®¡ç†å±¤ç¶“é©—', 'é€±æœŸç®¡ç†èƒ½åŠ›', 'æˆæœ¬æ§åˆ¶']
                    },
                    valuation: { 
                        weight: 30, 
                        name: 'ä¼°å€¼', 
                        indicators: ['P/B', 'EV/EBITDA', 'é€±æœŸèª¿æ•´P/E', 'è‚¡æ¯æ®–åˆ©ç‡'],
                        qualitative: ['é€±æœŸä½ç½®', 'è³‡ç”¢é‡ä¼°æ½›åŠ›', 'ä½µè³¼åƒ¹å€¼']
                    },
                    profitability: { 
                        weight: 20, 
                        name: 'ç›ˆåˆ©èƒ½åŠ›', 
                        indicators: ['ROEé€±æœŸæ€§', 'æ¯›åˆ©ç‡ç©©å®šæ€§', 'ç‡Ÿé‹æ§“æ¡¿'],
                        qualitative: ['å®šåƒ¹èƒ½åŠ›', 'æˆæœ¬å½ˆæ€§', 'ç”¢èƒ½åˆ©ç”¨ç‡']
                    },
                    growth: { 
                        weight: 10, 
                        name: 'æˆé•·æ€§', 
                        indicators: ['ç”¢èƒ½æ“´å¼µ', 'å¸‚å ç‡è®ŠåŒ–', 'æ–°å¸‚å ´é€²å…¥'],
                        qualitative: ['æ“´å¼µç­–ç•¥', 'æŠ€è¡“å‡ç´š', 'ç”¢å“å‰µæ–°']
                    }
                },
                valuation: {
                    pessimistic: { pb: 0.8, desc: 'P/B=0.8x, é€±æœŸåº•éƒ¨' },
                    neutral: { pb: 1.2, desc: 'P/B=1.2x, é€±æœŸä¸­æ®µ' },
                    optimistic: { pb: 1.8, desc: 'P/B=1.8x, é€±æœŸé«˜é»' }
                }
            },
            defensive: {
                name: 'é˜²ç¦¦å‹',
                baseWeights: { profitability: 35, health: 30, valuation: 25, growth: 10 },
                modules: {
                    profitability: { 
                        weight: 35, 
                        name: 'ç›ˆåˆ©èƒ½åŠ›', 
                        indicators: ['ROEç©©å®šæ€§', 'è‚¡æ¯ç‡', 'æ·¨åˆ©ç‡', 'è‡ªç”±ç¾é‡‘æµ'],
                        qualitative: ['å•†æ¥­æ¨¡å¼ç©©å®šæ€§', 'å®¢æˆ¶é»æ€§', 'å®šåƒ¹èƒ½åŠ›']
                    },
                    health: { 
                        weight: 30, 
                        name: 'è²¡å‹™å¥åº·', 
                        indicators: ['è² å‚µç‡', 'åˆ©æ¯è¦†è“‹', 'æµå‹•æ¯”ç‡'],
                        qualitative: ['è²¡å‹™ä¿å®ˆæ€§', 'ç¾é‡‘ç®¡ç†', 'é¢¨éšªæ§åˆ¶']
                    },
                    valuation: { 
                        weight: 25, 
                        name: 'ä¼°å€¼', 
                        indicators: ['è‚¡æ¯æ®–åˆ©ç‡', 'P/E', 'Betaä¿‚æ•¸'],
                        qualitative: ['å¸‚å ´åœ°ä½', 'å“ç‰Œåƒ¹å€¼', 'ç›£ç®¡ä¿è­·']
                    },
                    growth: { 
                        weight: 10, 
                        name: 'æˆé•·æ€§', 
                        indicators: ['ç‡Ÿæ”¶ç©©å®šæ€§', 'å¸‚å ç‡', 'å®¢æˆ¶é»æ€§'],
                        qualitative: ['å¸‚å ´æ“´å¼µ', 'ç”¢å“å¤šå…ƒåŒ–', 'æŠ€è¡“å‡ç´š']
                    }
                },
                valuation: {
                    pessimistic: { yield: 6, desc: 'è‚¡æ¯æ®–åˆ©ç‡=6%' },
                    neutral: { yield: 4.5, desc: 'è‚¡æ¯æ®–åˆ©ç‡=4.5%' },
                    optimistic: { yield: 3.5, desc: 'è‚¡æ¯æ®–åˆ©ç‡=3.5%' }
                }
            },
            financial: {
                name: 'é‡‘èå‹',
                baseWeights: { health: 35, profitability: 35, valuation: 20, growth: 10 },
                modules: {
                    health: { 
                        weight: 35, 
                        name: 'è²¡å‹™å¥åº·', 
                        indicators: ['è³‡æœ¬é©è¶³ç‡', 'é€¾æ”¾æ¯”', 'å‚™æŠµè¦†è“‹ç‡', 'æµå‹•æ€§æ¯”ç‡'],
                        qualitative: ['é¢¨éšªç®¡ç†', 'ç›£ç®¡åˆè¦', 'è³‡æœ¬ç®¡ç†']
                    },
                    profitability: { 
                        weight: 35, 
                        name: 'ç›ˆåˆ©èƒ½åŠ›', 
                        indicators: ['ROE', 'æ·¨åˆ©å·®', 'æˆæœ¬æ”¶å…¥æ¯”', 'æ‰‹çºŒè²»æ”¶å…¥æ¯”'],
                        qualitative: ['å•†æ¥­æ¨¡å¼', 'å®¢æˆ¶é»æ€§', 'äº¤å‰éŠ·å”®']
                    },
                    valuation: { 
                        weight: 20, 
                        name: 'ä¼°å€¼', 
                        indicators: ['P/B', 'æœ¬ç›Šæ¯”', 'è‚¡åƒ¹æ·¨å€¼æ¯”', 'P/TBV'],
                        qualitative: ['å¸‚å ´åœ°ä½', 'å“ç‰Œåƒ¹å€¼', 'ä½µè³¼æº¢åƒ¹']
                    },
                    growth: { 
                        weight: 10, 
                        name: 'æˆé•·æ€§', 
                        indicators: ['æ”¾æ¬¾æˆé•·', 'å­˜æ¬¾æˆé•·', 'æ–°æ¥­å‹™æ”¶å…¥'],
                        qualitative: ['æ•¸ä½è½‰å‹', 'å¸‚å ´æ“´å¼µ', 'ç”¢å“å‰µæ–°']
                    }
                },
                valuation: {
                    pessimistic: { pb: 0.7, desc: 'P/B=0.7x, åˆ©å·®å£“ç¸®+ä¿¡ç”¨é¢¨éšª' },
                    neutral: { pb: 1.0, desc: 'P/B=1.0x, ç©©å®šç¶“ç‡Ÿç’°å¢ƒ' },
                    optimistic: { pb: 1.4, desc: 'P/B=1.4x, åˆ©ç‡ä¸Šå‡å—ç›Š' }
                }
            },
            capital: {
                name: 'è³‡æœ¬å¯†é›†å‹',
                baseWeights: { health: 35, valuation: 30, profitability: 25, growth: 10 },
                modules: {
                    health: { 
                        weight: 35, 
                        name: 'è²¡å‹™å¥åº·', 
                        indicators: ['è² å‚µç‡', 'åˆ©æ¯è¦†è“‹', 'ç‡Ÿé‹ç¾é‡‘æµ', 'è³‡æœ¬æ”¯å‡ºæ¯”'],
                        qualitative: ['å‚µå‹™ç®¡ç†', 'ç¾é‡‘æµç©©å®šæ€§', 'è³‡ç”¢å“è³ª']
                    },
                    valuation: { 
                        weight: 30, 
                        name: 'ä¼°å€¼', 
                        indicators: ['P/B', 'EV/EBITDA', 'NAVæŠ˜åƒ¹'],
                        qualitative: ['è³‡ç”¢é‡ä¼°æ½›åŠ›', 'é€±æœŸä½ç½®', 'ä½µè³¼åƒ¹å€¼']
                    },
                    profitability: { 
                        weight: 25, 
                        name: 'ç›ˆåˆ©èƒ½åŠ›', 
                        indicators: ['ROIC', 'è³‡ç”¢å‘¨è½‰ç‡', 'æ¯›åˆ©ç‡'],
                        qualitative: ['ç‡Ÿé‹æ•ˆç‡', 'æˆæœ¬æ§åˆ¶', 'å®šåƒ¹èƒ½åŠ›']
                    },
                    growth: { 
                        weight: 10, 
                        name: 'æˆé•·æ€§', 
                        indicators: ['è³‡ç”¢æ“´å¼µ', 'ç§Ÿé‡‘æˆé•·', 'å…¥ä½ç‡'],
                        qualitative: ['æ“´å¼µç­–ç•¥', 'å¸‚å ´æ©Ÿæœƒ', 'ç”¢å“å‰µæ–°']
                    }
                },
                valuation: {
                    pessimistic: { pb: 0.8, desc: 'P/B=0.8x, è³‡ç”¢æ¸›å€¼é¢¨éšª' },
                    neutral: { pb: 1.2, desc: 'P/B=1.2x, ç©©å®šç¶“ç‡Ÿ' },
                    optimistic: { pb: 1.6, desc: 'P/B=1.6x, è³‡ç”¢é‡ä¼°' }
                }
            },
            consumer: {
                name: 'æ¶ˆè²»å‹',
                baseWeights: { growth: 35, profitability: 30, valuation: 25, health: 10 },
                modules: {
                    growth: { 
                        weight: 35, 
                        name: 'æˆé•·æ€§', 
                        indicators: ['åŒåº—æˆé•·ç‡', 'æ–°å“æˆåŠŸç‡', 'é€šè·¯æ“´å¼µ', 'å¸‚å ´ä»½é¡'],
                        qualitative: ['å“ç‰ŒåŠ›', 'å‰µæ–°èƒ½åŠ›', 'å¸‚å ´æ“´å¼µ']
                    },
                    profitability: { 
                        weight: 30, 
                        name: 'ç›ˆåˆ©èƒ½åŠ›', 
                        indicators: ['æ¯›åˆ©ç‡', 'ROE', 'å“ç‰Œæº¢åƒ¹', 'å­˜è²¨å‘¨è½‰'],
                        qualitative: ['å®šåƒ¹èƒ½åŠ›', 'æˆæœ¬æ§åˆ¶', 'ç‡Ÿé‹æ•ˆç‡']
                    },
                    valuation: { 
                        weight: 25, 
                        name: 'ä¼°å€¼', 
                        indicators: ['P/E', 'EV/EBITDA', 'å“ç‰Œåƒ¹å€¼å€æ•¸'],
                        qualitative: ['å¸‚å ´é æœŸ', 'æˆé•·æŒçºŒæ€§', 'ç«¶çˆ­å„ªå‹¢']
                    },
                    health: { 
                        weight: 10, 
                        name: 'è²¡å‹™å¥åº·', 
                        indicators: ['ç¾é‡‘æµ', 'è² å‚µç‡', 'ç‡Ÿé‹è³‡é‡‘'],
                        qualitative: ['è²¡å‹™ç®¡ç†', 'ç¾é‡‘è½‰æ›', 'è³‡é‡‘æ•ˆç‡']
                    }
                },
                valuation: {
                    pessimistic: { pe: 15, desc: 'P/E=15x, æ¶ˆè²»èç¸®' },
                    neutral: { pe: 22, desc: 'P/E=22x, ç©©å¥æˆé•·' },
                    optimistic: { pe: 30, desc: 'P/E=30x, æ¶ˆè²»å‡ç´š' }
                }
            }
        };
        
        let selectedIndustry = null;
        let selectedEnvironment = null;
        let selectedExchange = 'us';
        let moduleScores = {};
        let qualitativeScores = {};
        let marketEnvironment = {};
        let confidenceLevel = 50;
        
        // æ•¸æ“šæŒä¹…åŒ–ç®¡ç†
        class DataManager {
            constructor() {
                this.storageKey = 'investmentAnalysis';
                this.backupKey = 'investmentBackup';
            }
            
            saveAnalysis(data) {
                try {
                    const analysisData = {
                        ...data,
                        timestamp: new Date().toISOString(),
                        version: '2.0'
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(analysisData));
                    this.createBackup(analysisData);
                    return true;
                } catch (error) {
                    console.error('ä¿å­˜å¤±æ•—:', error);
                    return false;
                }
            }
            
            loadAnalysis() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('è¼‰å…¥å¤±æ•—:', error);
                    return null;
                }
            }
            
            createBackup(data) {
                const backups = this.getBackups() || [];
                backups.push({
                    data,
                    timestamp: new Date().toISOString()
                });
                
                if (backups.length > 10) {
                    backups.splice(0, backups.length - 10);
                }
                
                localStorage.setItem(this.backupKey, JSON.stringify(backups));
            }
            
            getBackups() {
                try {
                    const backups = localStorage.getItem(this.backupKey);
                    return backups ? JSON.parse(backups) : [];
                } catch (error) {
                    return [];
                }
            }
            
            exportAllData() {
                const currentData = this.loadAnalysis();
                const backups = this.getBackups();
                
                const exportData = {
                    current: currentData,
                    backups: backups,
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                
                return JSON.stringify(exportData, null, 2);
            }
            
            importData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    if (data.current) {
                        this.saveAnalysis(data.current);
                    }
                    if (data.backups) {
                        localStorage.setItem(this.backupKey, JSON.stringify(data.backups));
                    }
                    return true;
                } catch (error) {
                    console.error('å°å…¥å¤±æ•—:', error);
                    return false;
                }
            }
        }
        
        const dataManager = new DataManager();
        
        // äº¤æ˜“æ‰€é¸æ“‡äº‹ä»¶
        document.getElementById('exchange').addEventListener('change', function() {
            selectedExchange = this.value;
            updateCurrencyDisplay();
            updateMarketCapDisplay();
        });
        
        // æ›´æ–°è²¨å¹£é¡¯ç¤º
        function updateCurrencyDisplay() {
            const config = marketConfigs[selectedExchange];
            if (config) {
                document.getElementById('currencyDisplay').textContent = config.currency;
                document.getElementById('marketCapDisplay').textContent = `å„„${config.currency}`;
            }
        }
        
        // æ›´æ–°å¸‚å€¼é¡¯ç¤º
        function updateMarketCapDisplay() {
            const marketCap = parseFloat(document.getElementById('marketCap').value);
            const config = marketConfigs[selectedExchange];
            
            if (marketCap && config) {
                let sizeLabel = '';
                if (marketCap <= config.marketCapLevels.small.max) {
                    sizeLabel = config.marketCapLevels.small.label;
                } else if (marketCap <= config.marketCapLevels.mid.max) {
                    sizeLabel = config.marketCapLevels.mid.label;
                } else {
                    sizeLabel = config.marketCapLevels.large.label;
                }
                document.getElementById('marketCapSize').textContent = sizeLabel;
            }
        }
        
        // å¸‚å€¼è¼¸å…¥äº‹ä»¶
        document.getElementById('marketCap').addEventListener('input', updateMarketCapDisplay);
        
        // å¸‚å ´ç’°å¢ƒé¸æ“‡äº‹ä»¶
        document.querySelectorAll('.env-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.env-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedEnvironment = this.dataset.env;
                updateDynamicWeights();
            });
        });
        
        // å¸‚å ´æƒ…ç·’é¸æ“‡äº‹ä»¶
        document.querySelectorAll('.sentiment-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.sentiment-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                marketEnvironment.sentiment = this.dataset.sentiment;
                updateRiskAssessment();
            });
        });
        
        // ç”¢æ¥­é¸æ“‡äº‹ä»¶
        document.querySelectorAll('.industry-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.industry-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedIndustry = this.dataset.industry;
                generateEnhancedModules();
                updateDynamicWeights();
            });
        });
        
        // VIXæŒ‡æ•¸è§£è®€
        document.getElementById('vixIndex').addEventListener('input', function() {
            const vix = parseFloat(this.value);
            const interpretation = document.getElementById('vixInterpretation');
            if (vix < 20) {
                interpretation.textContent = 'å¸‚å ´å¹³éœ';
                interpretation.style.color = '#16a34a';
            } else if (vix < 30) {
                interpretation.textContent = 'é©åº¦ç„¦æ…®';
                interpretation.style.color = '#d97706';
            } else {
                interpretation.textContent = 'æ¥µåº¦ææ…Œ';
                interpretation.style.color = '#dc2626';
            }
        });
        
        // è³ªåŒ–åˆ†ææ»‘æ¡¿äº‹ä»¶
        ['ceoLeadership', 'strategy', 'innovation', 'brandValue'].forEach(id => {
            const slider = document.getElementById(id);
            const display = document.getElementById(id.replace(/([A-Z])/g, '') + 'Value') ||
